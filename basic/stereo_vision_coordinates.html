<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>立体视觉中的四大坐标系</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .coord-systems {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .coord-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .coord-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .coord-card.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }

        .coord-card h3 {
            color: white;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coord-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .world { background: #FF6B6B; }
        .camera { background: #4ECDC4; }
        .image { background: #45B7D1; }
        .pixel { background: #96CEB4; }

        .coord-card p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .coord-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .coord-details.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .transformation-flow {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .transformation-flow h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            text-align: center;
            position: relative;
        }

        .flow-box {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .flow-box:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .flow-step h4 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .flow-step p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .arrow {
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .flow-step:last-child .arrow {
            display: none;
        }

        .formula-derivation {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formula-derivation h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .derivation-section {
            margin-bottom: 30px;
        }

        .derivation-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-left: 4px solid #4CAF50;
            padding-left: 15px;
        }

        .formula-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formula-title {
            color: #4CAF50;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            color: #E8F5E8;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            text-align: center;
            line-height: 1.8;
        }

        /* 改善数学公式显示 */
        .formula sup {
            font-size: 0.7em;
            vertical-align: top;
        }

        .formula sub {
            font-size: 0.7em;
            vertical-align: bottom;
        }

        /* 改善矩阵显示 */
        .matrix {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            line-height: 1.8;
            white-space: nowrap;
            font-family: 'Courier New', monospace;
            display: inline-block;
            vertical-align: middle;
            font-size: 1rem;
        }

        .matrix-eq {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .matrix-eq.large {
            font-size: 1.2rem;
        }

        .matrix-display {
            text-align: center;
            margin: 15px 0;
            color: #E8F5E8;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }

        .formula-line {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .fraction-inline {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            vertical-align: middle;
            font-size: 1em;
        }

        .fraction-inline .numerator {
            border-bottom: 1px solid currentColor;
            padding-bottom: 3px;
            margin-bottom: 3px;
            min-width: 20px;
            text-align: center;
            line-height: 1;
        }

        .fraction-inline .denominator {
            padding-top: 3px;
            min-width: 20px;
            text-align: center;
            line-height: 1;
        }

        .formula-detail {
            color: rgba(255, 255, 255, 0.9);
            margin-top: 15px;
            line-height: 1.6;
        }

        .formula-detail p {
            margin-bottom: 8px;
        }

        .derivation-steps {
            margin: 15px 0;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            gap: 10px;
        }

        .step-num {
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .inverse-steps {
            text-align: left;
        }

        .inv-step {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .inv-formula {
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            color: #E8F5E8;
            font-size: 1rem;
            line-height: 1.6;
        }

        .calc-steps {
            margin: 20px 0;
        }

        .calc-step {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }

        .calc-formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #E8F5E8;
            line-height: 1.5;
        }

        .calc-result {
            color: #4CAF50;
            font-weight: bold;
            margin-top: 10px;
        }

        .calc-params {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        /* 调整主要内容区域的顶部间距 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 添加平滑滚动 */
        html {
            scroll-behavior: smooth;
        }

        /* 移动端导航优化 */
        @media (max-width: 768px) {
            .flow-diagram {
                flex-direction: column;
            }
            
            .arrow {
                display: none;
            }
            
            .matrix-eq {
                flex-direction: column;
                gap: 10px;
            }
            
            .formula {
                font-size: 1rem;
                padding: 15px;
            }
            
            .matrix {
                font-size: 0.9rem;
                padding: 10px;
            }
            
            .fraction-inline {
                margin: 0 4px;
                font-size: 0.9em;
            }
        }

        /* 公式元素样式 */
        .eq-symbol {
            font-size: 1.5em;
            margin: 0 10px;
        }

        .mult-symbol {
            font-size: 1.5em;
            margin: 0 5px;
        }

        .plus-symbol {
            font-size: 1.5em;
            margin: 0 10px;
        }

        .formula-note {
            margin-top: 20px;
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }

        .matrix-large {
            font-size: 1.1rem;
            padding: 20px;
        }

        .matrix-medium {
            font-size: 1rem;
            padding: 20px;
        }

        /* 改善矩阵对齐显示 */
        .matrix {
            letter-spacing: 0.05em;
            text-align: center;
        }

        .matrix-eq .matrix {
            min-width: 60px;
        }

        /* 改善数学符号间距 */
        .mult-symbol {
            font-size: 1.5em;
            margin: 0 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 立体视觉中的四大坐标系</h1>
            <p>从3D世界到2D像素：揭秘计算机视觉的空间变换之旅</p>
        </div>

        <div class="coord-systems">
            <div class="coord-card" onclick="toggleDetails('world')">
                <h3><span class="coord-icon world">W</span>世界坐标系</h3>
                <p><strong>全局3D参考系</strong></p>
                <p>定义真实世界中物体的绝对位置</p>
                <div class="coord-details" id="world-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：场景中的固定点</p>
                    <p>• 单位：实际物理单位（米、毫米等）</p>
                    <p>• 坐标：(Xw, Yw, Zw)</p>
                    <p>• 用途：描述物体在真实世界中的绝对位置</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('camera')">
                <h3><span class="coord-icon camera">C</span>相机坐标系</h3>
                <p><strong>以相机为中心的3D坐标系</strong></p>
                <p>光心为原点，光轴为Z轴</p>
                <div class="coord-details" id="camera-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：相机光心（投影中心）</p>
                    <p>• Z轴：沿光轴方向（向前）</p>
                    <p>• 坐标：(Xc, Yc, Zc)</p>
                    <p>• 用途：简化透视投影计算</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('image')">
                <h3><span class="coord-icon image">I</span>图像坐标系</h3>
                <p><strong>成像平面上的2D坐标系</strong></p>
                <p>物理单位的图像平面坐标</p>
                <div class="coord-details" id="image-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：主点（光轴与成像平面交点）</p>
                    <p>• 单位：物理单位（毫米）</p>
                    <p>• 坐标：(x, y)</p>
                    <p>• 用途：透视投影的中间结果</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('pixel')">
                <h3><span class="coord-icon pixel">P</span>像素坐标系</h3>
                <p><strong>数字图像的离散坐标系</strong></p>
                <p>以像素为单位的图像坐标</p>
                <div class="coord-details" id="pixel-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：图像左上角像素(0,0)</p>
                    <p>• 单位：像素</p>
                    <p>• 坐标：(u, v)，整数值</p>
                    <p>• 用途：数字图像处理和显示</p>
                </div>
            </div>
        </div>

        <div class="transformation-flow">
            <h2>🔄 坐标变换流程</h2>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>世界坐标</h4>
                        <p>(Xw, Yw, Zw)</p>
                        <p>真实3D位置</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>相机坐标</h4>
                        <p>(Xc, Yc, Zc)</p>
                        <p>旋转+平移</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>图像坐标</h4>
                        <p>(x, y)</p>
                        <p>透视投影</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>像素坐标</h4>
                        <p>(u, v)</p>
                        <p>缩放+偏移</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="formula-derivation">
            <h2>📐 坐标变换公式推导</h2>
            
            <div class="derivation-section">
                <h3>1️⃣ 世界坐标系 → 相机坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">刚体变换（旋转+平移）</div>
                    <div class="formula">
                        <div class="matrix-eq">
                            <span class="matrix">
                                [X<sup>c</sup>]<br>
                                [Y<sup>c</sup>]<br>
                                [Z<sup>c</sup>]
                            </span>
                            <span class="eq-symbol">=</span>
                            <span class="mult-symbol">R</span>
                            <span class="mult-symbol">·</span>
                            <span class="matrix">
                                [X<sup>w</sup>]<br>
                                [Y<sup>w</sup>]<br>
                                [Z<sup>w</sup>]
                            </span>
                            <span class="plus-symbol">+</span>
                            <span class="matrix">
                                [t<sub>x</sub>]<br>
                                [t<sub>y</sub>]<br>
                                [t<sub>z</sub>]
                            </span>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>其中：</strong></p>
                        <p>• R 是 3×3 旋转矩阵，描述相机相对于世界坐标系的姿态</p>
                        <p>• T = [t<sub>x</sub>, t<sub>y</sub>, t<sub>z</sub>]ᵀ 是平移向量，描述相机在世界坐标系中的位置</p>
                        <p>• 旋转矩阵 R 是正交矩阵，满足 R⁻¹ = Rᵀ</p>
                        <p>• 这个变换将世界坐标系中的点转换到相机坐标系</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>2️⃣ 相机坐标系 → 图像坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">透视投影变换</div>
                    <div class="formula">
                        <div class="formula-line">
                            x = f × <span class="fraction-inline"><span class="numerator">X<sup>c</sup></span><span class="denominator">Z<sup>c</sup></span></span>
                        </div>
                        <div class="formula-line">
                            y = f × <span class="fraction-inline"><span class="numerator">Y<sup>c</sup></span><span class="denominator">Z<sup>c</sup></span></span>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>推导过程：</strong></p>
                        <p>根据相似三角形原理：</p>
                        <div class="derivation-steps">
                            <div class="step">
                                <span class="step-num">①</span>
                                <span class="step-content">光线从3D点 (Xᶜ, Yᶜ, Zᶜ) 投射到成像平面</span>
                            </div>
                            <div class="step">
                                <span class="step-num">②</span>
                                <span class="step-content">成像平面距离光心的距离为焦距 f</span>
                            </div>
                            <div class="step">
                                <span class="step-num">③</span>
                                <span class="step-content">由相似三角形：x/f = Xᶜ/Zᶜ，y/f = Yᶜ/Zᶜ</span>
                            </div>
                        </div>
                        <p>• f 是相机的焦距（单位：mm）</p>
                        <p>• 注意：Z坐标必须为正值（物体在相机前方）</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>3️⃣ 图像坐标系 → 像素坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">尺度变换和坐标原点平移</div>
                    <div class="formula">
                        <div class="formula-line">
                            u = <span class="fraction-inline"><span class="numerator">x</span><span class="denominator">d<sub>x</sub></span></span> + u₀
                        </div>
                        <div class="formula-line">
                            v = <span class="fraction-inline"><span class="numerator">y</span><span class="denominator">d<sub>y</sub></span></span> + v₀
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>参数说明：</strong></p>
                        <p>• dₓ, dᵧ：每个像素在 X, Y 方向上的物理尺寸（mm/pixel）</p>
                        <p>• (u₀, v₀)：主点在像素坐标系中的位置（通常接近图像中心）</p>
                        <p>• 坐标原点从图像中心移动到左上角</p>
                        <p>• Y轴方向可能需要翻转（图像坐标系Y轴向下）</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>4️⃣ 完整的投影矩阵</h3>
                <div class="formula-box">
                    <div class="formula-title">齐次坐标表示</div>
                    <div class="formula">
                        <div class="matrix-eq large">
                            <span class="matrix">
                                [u]<br>
                                [v]<br>
                                [1]
                            </span>
                            <span class="eq-symbol" style="margin: 0 15px;">=</span>
                            <span class="mult-symbol">K</span>
                            <span class="mult-symbol">·</span>
                            <span class="mult-symbol">[R | T]</span>
                            <span class="mult-symbol">·</span>
                            <span class="matrix">
                                [Xʷ]<br>
                                [Yʷ]<br>
                                [Zʷ]<br>
                                [1]
                            </span>
                        </div>
                        <div class="formula-note">
                            齐次坐标下的完整投影变换
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>内参矩阵 K：</strong></p>
                        <div class="matrix-display">
                            K = <span class="matrix matrix-large">
                                [f<sub>x</sub>&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;u₀]<br>
                                [&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;f<sub>y</sub>&nbsp;&nbsp;&nbsp;&nbsp;v₀]<br>
                                [&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;]
                            </span>
                        </div>
                        <p><strong>外参矩阵 [R | T]：</strong></p>
                        <div class="matrix-display">
                            [R | T] = <span class="matrix matrix-medium">
                                [r₁₁&nbsp;&nbsp;r₁₂&nbsp;&nbsp;r₁₃&nbsp;&nbsp;|&nbsp;&nbsp;t<sub>x</sub>]<br>
                                [r₂₁&nbsp;&nbsp;r₂₂&nbsp;&nbsp;r₂₃&nbsp;&nbsp;|&nbsp;&nbsp;t<sub>y</sub>]<br>
                                [r₃₁&nbsp;&nbsp;r₃₂&nbsp;&nbsp;r₃₃&nbsp;&nbsp;|&nbsp;&nbsp;t<sub>z</sub>]
                            </span>
                        </div>
                        <p><strong>参数说明：</strong></p>
                        <p>• f<sub>x</sub> = f/dₓ, f<sub>y</sub> = f/dᵧ：像素焦距</p>
                        <p>• (u₀, v₀)：主点在像素坐标系中的坐标</p>
                        <p>• R：3×3 旋转矩阵，T：3×1 平移向量</p>
                        <p>• 完整的投影矩阵 P = K[R | T] 是 3×4 矩阵</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>5️⃣ 逆变换（深度估计）</h3>
                <div class="formula-box">
                    <div class="formula-title">从像素坐标恢复3D信息</div>
                    <div class="formula">
                        <div class="inverse-steps">
                            <div class="inv-step">
                                <strong>步骤1:</strong> 像素 → 图像坐标
                                <div class="inv-formula">
                                    x = (u - u₀) · dₓ<br>
                                    y = (v - v₀) · dᵧ
                                </div>
                            </div>
                            <div class="inv-step">
                                <strong>步骤2:</strong> 图像 → 相机坐标（需要深度Z）
                                <div class="inv-formula">
                                    Xᶜ = x · Z/f<br>
                                    Yᶜ = y · Z/f<br>
                                    Zᶜ = Z
                                </div>
                            </div>
                            <div class="inv-step">
                                <strong>步骤3:</strong> 相机 → 世界坐标
                                <div class="inv-formula">
                                    [Xʷ, Yʷ, Zʷ]ᵀ = R⁻¹([Xᶜ, Yᶜ, Zᶜ]ᵀ - T)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>关键问题：</strong>从单张图像无法直接获得深度信息Z</p>
                        <p><strong>解决方案：</strong></p>
                        <p>• 立体视觉：使用两个相机进行三角测量</p>
                        <p>• 深度传感器：结合RGB-D相机</p>
                        <p>• 先验知识：已知物体尺寸或场景约束</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>6️⃣ 详细数学推导过程</h3>
                <div class="formula-box">
                    <div class="formula-title">完整的坐标变换链</div>
                    <div class="formula">
                        <div style="margin: 20px 0; text-align: left;">
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤1: 世界 → 相机坐标</strong>
                                <div class="matrix-display" style="margin: 10px 0;">
                                    <span class="matrix" style="font-size: 1rem;">
                                        [X<sup>c</sup>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[r₁₁&nbsp;&nbsp;r₁₂&nbsp;&nbsp;r₁₃]&nbsp;&nbsp;&nbsp;[X<sup>w</sup>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[t<sub>x</sub>]<br>
                                        [Y<sup>c</sup>] = [r₂₁&nbsp;&nbsp;r₂₂&nbsp;&nbsp;r₂₃] × [Y<sup>w</sup>] + [t<sub>y</sub>]<br>
                                        [Z<sup>c</sup>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[r₃₁&nbsp;&nbsp;r₃₂&nbsp;&nbsp;r₃₃]&nbsp;&nbsp;&nbsp;[Z<sup>w</sup>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[t<sub>z</sub>]
                                    </span>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤2: 相机 → 图像坐标</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    x = f × (Xᶜ / Zᶜ)<br>
                                    y = f × (Yᶜ / Zᶜ)
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤3: 图像 → 像素坐标</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    u = (x / dₓ) + u₀ = (f × Xᶜ) / (dₓ × Zᶜ) + u₀<br>
                                    v = (y / dᵧ) + v₀ = (f × Yᶜ) / (dᵧ × Zᶜ) + v₀
                                </div>
                            </div>
                            <div style="background: rgba(76, 175, 80, 0.2); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid #4CAF50;">
                                <strong style="color: #4CAF50;">最终结果: 合并表达式</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    u = (f<sub>x</sub> × Xᶜ) / Zᶜ + u₀<br>
                                    v = (f<sub>y</sub> × Yᶜ) / Zᶜ + v₀
                                </div>
                                <div style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
                                    其中：f<sub>x</sub> = f/dₓ, f<sub>y</sub> = f/dᵧ
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>关键理解：</strong></p>
                        <p>• 每个步骤都是可逆的（除了深度信息的丢失）</p>
                        <p>• 旋转和平移是刚体变换，保持形状和大小不变</p>
                        <p>• 透视投影是非线性变换，远处物体看起来更小</p>
                        <p>• 像素化是离散化过程，可能引入量化误差</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="formula-derivation">
            <h2>📋 公式速查表</h2>
            
            <div class="derivation-section">
                <div class="formula-box">
                    <div class="formula-title">立体视觉核心公式总览</div>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                            <thead>
                                <tr style="background: rgba(102, 126, 234, 0.2);">
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">变换类型</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">公式</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">用途</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">误差特性</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">世界→相机</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">P<sub>c</sub> = R·P<sub>w</sub> + T</td>
                                    <td style="padding: 12px; color: #ccc;">坐标系转换</td>
                                    <td style="padding: 12px; color: #FFA500;">标定精度影响</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">相机→图像</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">x = f·X<sub>c</sub>/Z<sub>c</sub><br>y = f·Y<sub>c</sub>/Z<sub>c</sub></td>
                                    <td style="padding: 12px; color: #ccc;">透视投影</td>
                                    <td style="padding: 12px; color: #FF6347;">深度敏感</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">图像→像素</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">u = f<sub>x</sub>·X<sub>c</sub>/Z<sub>c</sub> + u<sub>0</sub><br>v = f<sub>y</sub>·Y<sub>c</sub>/Z<sub>c</sub> + v<sub>0</sub></td>
                                    <td style="padding: 12px; color: #ccc;">数字化</td>
                                    <td style="padding: 12px; color: #9C27B0;">量化误差</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #2196F3;">深度估计</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">Z = f·B/d</td>
                                    <td style="padding: 12px; color: #ccc;">双目测距</td>
                                    <td style="padding: 12px; color: #FF6347;">误差∝Z²</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #FF6347;">深度精度</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">σ<sub>Z</sub> = Z²/(f·B)·σ<sub>d</sub></td>
                                    <td style="padding: 12px; color: #ccc;">误差分析</td>
                                    <td style="padding: 12px; color: #FF6347;">距离平方关系</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; font-weight: bold; color: #FFC107;">视场角</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">FOV = 2·arctan(w/2f)</td>
                                    <td style="padding: 12px; color: #ccc;">系统设计</td>
                                    <td style="padding: 12px; color: #4CAF50;">线性关系</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                            <h4 style="color: #4CAF50; margin-bottom: 10px;">📏 常用参数范围</h4>
                            <div style="font-size: 0.9rem; color: #ccc; line-height: 1.6;">
                                • 焦距: 5-200mm<br>
                                • 基线: 50-300mm<br>
                                • 像素尺寸: 2-10μm<br>
                                • 视差精度: 0.1-1 pixel
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #FFC107;">
                            <h4 style="color: #FFC107; margin-bottom: 10px;">⚡ 优化建议</h4>
                            <div style="font-size: 0.9rem; color: #ccc; line-height: 1.6;">
                                • 增大基线提高深度精度<br>
                                • 长焦镜头减少畸变<br>
                                • 亚像素算法提升精度<br>
                                • 多尺度匹配增强鲁棒性
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleDetails(coordType) {
            const details = document.getElementById(coordType + '-details');
            const card = details.parentElement;
            
            // Close all other details
            document.querySelectorAll('.coord-details').forEach(detail => {
                if (detail !== details) {
                    detail.classList.remove('show');
                    detail.parentElement.classList.remove('active');
                }
            });
            
            // Toggle current details
            details.classList.toggle('show');
            card.classList.toggle('active');
        }

        // 页面加载时的动画效果
        window.addEventListener('load', function() {
            const cards = document.querySelectorAll('.coord-card');
            cards.forEach((card, index) => {
                card.style.animation = `fadeIn 0.6s ease ${index * 0.1}s forwards`;
                card.style.opacity = '0';
            });
        });

        // 添加 CSS 动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
    
    <style>
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            div[style*="position: fixed"] {
                bottom: 20px !important;
                right: 20px !important;
            }
            
            div[style*="position: fixed"] a {
                padding: 10px 16px !important;
                font-size: 12px !important;
            }
        }
    </style>
</body>
</html>