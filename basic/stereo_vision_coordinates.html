<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>立体视觉中的四大坐标系</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .coord-systems {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .coord-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .coord-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .coord-card.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }

        .coord-card h3 {
            color: white;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coord-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .world { background: #FF6B6B; }
        .camera { background: #4ECDC4; }
        .image { background: #45B7D1; }
        .pixel { background: #96CEB4; }

        .coord-card p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .coord-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .coord-details.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .transformation-flow {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .transformation-flow h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            text-align: center;
            position: relative;
        }

        .flow-box {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .flow-box:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .flow-step h4 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .flow-step p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .arrow {
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .flow-step:last-child .arrow {
            display: none;
        }

        .interactive-demo {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .demo-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            color: white;
            font-size: 0.9rem;
        }

        .control-group input {
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 100px;
        }

        .control-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .demo-result {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .formula-derivation {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formula-derivation h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .derivation-section {
            margin-bottom: 30px;
        }

        .derivation-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-left: 4px solid #4CAF50;
            padding-left: 15px;
        }

        .formula-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formula-title {
            color: #4CAF50;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            color: #E8F5E8;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            text-align: center;
            line-height: 1.8;
        }

        .matrix-eq {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .matrix-eq.large {
            font-size: 1.2rem;
        }

        .matrix {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            line-height: 1.8;
            white-space: nowrap;
            font-family: 'Courier New', monospace;
            display: inline-block;
            vertical-align: middle;
        }

        .matrix-display {
            text-align: center;
            margin: 15px 0;
            color: #E8F5E8;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }

        .formula-line {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .fraction-inline {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            vertical-align: middle;
            font-size: 1em;
        }

        .numerator {
            border-bottom: 1px solid currentColor;
            padding-bottom: 3px;
            margin-bottom: 3px;
            min-width: 20px;
            text-align: center;
        }

        .denominator {
            padding-top: 3px;
            min-width: 20px;
            text-align: center;
        }

        .fraction {
            position: relative;
            display: inline-block;
            text-align: center;
            vertical-align: middle;
        }

        .denominator {
            position: absolute;
            top: 1.2em;
            left: 0;
            right: 0;
            border-top: 1px solid currentColor;
            padding-top: 2px;
            font-size: 0.9em;
        }

        .formula-detail {
            color: rgba(255, 255, 255, 0.9);
            margin-top: 15px;
            line-height: 1.6;
        }

        .formula-detail p {
            margin-bottom: 8px;
        }

        .derivation-steps {
            margin: 15px 0;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            gap: 10px;
        }

        .step-num {
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .inverse-steps {
            text-align: left;
        }

        .inv-step {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .inv-formula {
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            color: #E8F5E8;
            font-size: 1rem;
            line-height: 1.6;
        }

        .applications {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .applications h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .app-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .app-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
        }

        .app-card h3 {
            color: white;
            margin-bottom: 10px;
        }

        .app-card p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .calc-steps {
            margin: 20px 0;
        }

        .calc-step {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }

        .calc-formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #E8F5E8;
            line-height: 1.5;
        }

        .calc-result {
            color: #4CAF50;
            font-weight: bold;
            margin-top: 10px;
        }

        .calc-params {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        /* 导航栏样式 */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1rem 2%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }

        .nav-links a:hover {
            color: #667eea;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-links a.active {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after {
            width: 80%;
        }

        /* 调整主要内容区域的顶部间距 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 20px 20px;
        }

        /* 页脚样式 */
        footer a:hover {
            color: #667eea !important;
            transform: translateY(-2px);
        }

        footer a[href="index.html"]:last-child:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        /* 添加平滑滚动 */
        html {
            scroll-behavior: smooth;
        }

        /* 移动端导航优化 */
        @media (max-width: 768px) {
            .nav-links {
                gap: 0.5rem;
            }
            
            .nav-links a {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
            
            .logo {
                font-size: 1rem;
            }
            
            footer > div > div {
                flex-direction: column;
                text-align: center;
            }
            
            footer div[style*="display: flex; gap: 20px"] {
                flex-direction: column;
                gap: 10px;
            }
            
            .flow-diagram {
                flex-direction: column;
            }
            
            .arrow {
                display: none;
            }
            
            .demo-controls {
                flex-direction: column;
            }
            
            .matrix-eq {
                flex-direction: column;
                gap: 10px;
            }
            
            .formula {
                font-size: 1rem;
            }
            
            .matrix {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">3D Camera World</a>
            <ul class="nav-links">
                <li><a href="index.html">🏠 首页</a></li>
                <li><a href="stereo_vision_coordinates.html" class="active">📐 坐标系</a></li>
                <li><a href="updated_laser_triangulation.html">📡 激光三角</a></li>
                <li><a href="index.html#demo">🎮 演示</a></li>
                <li><a href="index.html#applications">🚀 应用</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>🎯 立体视觉中的四大坐标系</h1>
            <p>从3D世界到2D像素：揭秘计算机视觉的空间变换之旅</p>
        </div>

        <div class="coord-systems">
            <div class="coord-card" onclick="toggleDetails('world')">
                <h3><span class="coord-icon world">W</span>世界坐标系</h3>
                <p><strong>全局3D参考系</strong></p>
                <p>定义真实世界中物体的绝对位置</p>
                <div class="coord-details" id="world-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：场景中的固定点</p>
                    <p>• 单位：实际物理单位（米、毫米等）</p>
                    <p>• 坐标：(Xw, Yw, Zw)</p>
                    <p>• 用途：描述物体在真实世界中的绝对位置</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('camera')">
                <h3><span class="coord-icon camera">C</span>相机坐标系</h3>
                <p><strong>以相机为中心的3D坐标系</strong></p>
                <p>光心为原点，光轴为Z轴</p>
                <div class="coord-details" id="camera-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：相机光心（投影中心）</p>
                    <p>• Z轴：沿光轴方向（向前）</p>
                    <p>• 坐标：(Xc, Yc, Zc)</p>
                    <p>• 用途：简化透视投影计算</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('image')">
                <h3><span class="coord-icon image">I</span>图像坐标系</h3>
                <p><strong>成像平面上的2D坐标系</strong></p>
                <p>物理单位的图像平面坐标</p>
                <div class="coord-details" id="image-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：主点（光轴与成像平面交点）</p>
                    <p>• 单位：物理单位（毫米）</p>
                    <p>• 坐标：(x, y)</p>
                    <p>• 用途：透视投影的中间结果</p>
                </div>
            </div>

            <div class="coord-card" onclick="toggleDetails('pixel')">
                <h3><span class="coord-icon pixel">P</span>像素坐标系</h3>
                <p><strong>数字图像的离散坐标系</strong></p>
                <p>以像素为单位的图像坐标</p>
                <div class="coord-details" id="pixel-details">
                    <p><strong>特点：</strong></p>
                    <p>• 原点：图像左上角像素(0,0)</p>
                    <p>• 单位：像素</p>
                    <p>• 坐标：(u, v)，整数值</p>
                    <p>• 用途：数字图像处理和显示</p>
                </div>
            </div>
        </div>

        <div class="transformation-flow">
            <h2>🔄 坐标变换流程</h2>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>世界坐标</h4>
                        <p>(Xw, Yw, Zw)</p>
                        <p>真实3D位置</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>相机坐标</h4>
                        <p>(Xc, Yc, Zc)</p>
                        <p>旋转+平移</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>图像坐标</h4>
                        <p>(x, y)</p>
                        <p>透视投影</p>
                    </div>
                    <span class="arrow">→</span>
                </div>
                <div class="flow-step">
                    <div class="flow-box">
                        <h4>像素坐标</h4>
                        <p>(u, v)</p>
                        <p>缩放+偏移</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="formula-derivation">
            <h2>📐 坐标变换公式推导</h2>
            
            <div class="derivation-section">
                <h3>1️⃣ 世界坐标系 → 相机坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">刚体变换（旋转+平移）</div>
                    <div class="formula">
                        <div class="matrix-eq">
                            <span class="matrix">
                                [Xᶜ]<br>
                                [Yᶜ]<br>
                                [Zᶜ]
                            </span>
                            <span style="font-size: 1.5em; margin: 0 10px;">=</span>
                            <span style="margin: 0 5px;">R</span>
                            <span style="font-size: 1.5em; margin: 0 5px;">·</span>
                            <span class="matrix">
                                [Xʷ]<br>
                                [Yʷ]<br>
                                [Zʷ]
                            </span>
                            <span style="font-size: 1.5em; margin: 0 10px;">+</span>
                            <span class="matrix">
                                [tₓ]<br>
                                [tᵧ]<br>
                                [tᵤ]
                            </span>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>其中：</strong></p>
                        <p>• R 是 3×3 旋转矩阵，描述相机相对于世界坐标系的姿态</p>
                        <p>• T = [tₓ, tᵧ, tᵤ]ᵀ 是平移向量，描述相机在世界坐标系中的位置</p>
                        <p>• 旋转矩阵 R 是正交矩阵，满足 R⁻¹ = Rᵀ</p>
                        <p>• 这个变换将世界坐标系中的点转换到相机坐标系</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>2️⃣ 相机坐标系 → 图像坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">透视投影变换</div>
                    <div class="formula">
                        <div class="formula-line">
                            x = f × <div class="fraction-inline"><span class="numerator">Xᶜ</span><span class="denominator">Zᶜ</span></div>
                        </div>
                        <div class="formula-line">
                            y = f × <div class="fraction-inline"><span class="numerator">Yᶜ</span><span class="denominator">Zᶜ</span></div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>推导过程：</strong></p>
                        <p>根据相似三角形原理：</p>
                        <div class="derivation-steps">
                            <div class="step">
                                <span class="step-num">①</span>
                                <span class="step-content">光线从3D点 (Xᶜ, Yᶜ, Zᶜ) 投射到成像平面</span>
                            </div>
                            <div class="step">
                                <span class="step-num">②</span>
                                <span class="step-content">成像平面距离光心的距离为焦距 f</span>
                            </div>
                            <div class="step">
                                <span class="step-num">③</span>
                                <span class="step-content">由相似三角形：x/f = Xᶜ/Zᶜ，y/f = Yᶜ/Zᶜ</span>
                            </div>
                        </div>
                        <p>• f 是相机的焦距（单位：mm）</p>
                        <p>• 注意：Z坐标必须为正值（物体在相机前方）</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>3️⃣ 图像坐标系 → 像素坐标系</h3>
                <div class="formula-box">
                    <div class="formula-title">尺度变换和坐标原点平移</div>
                    <div class="formula">
                        <div class="formula-line">
                            u = <div class="fraction-inline"><span class="numerator">x</span><span class="denominator">dₓ</span></div> + u₀
                        </div>
                        <div class="formula-line">
                            v = <div class="fraction-inline"><span class="numerator">y</span><span class="denominator">dᵧ</span></div> + v₀
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>参数说明：</strong></p>
                        <p>• dₓ, dᵧ：每个像素在 X, Y 方向上的物理尺寸（mm/pixel）</p>
                        <p>• (u₀, v₀)：主点在像素坐标系中的位置（通常接近图像中心）</p>
                        <p>• 坐标原点从图像中心移动到左上角</p>
                        <p>• Y轴方向可能需要翻转（图像坐标系Y轴向下）</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>4️⃣ 完整的投影矩阵</h3>
                <div class="formula-box">
                    <div class="formula-title">齐次坐标表示</div>
                    <div class="formula">
                        <div class="matrix-eq large">
                            <span class="matrix">
                                [u]<br>
                                [v]<br>
                                [1]
                            </span>
                            <span style="font-size: 1.5em; margin: 0 15px;">=</span>
                            <span style="margin: 0 5px;">K</span>
                            <span style="font-size: 1.5em; margin: 0 8px;">·</span>
                            <span style="margin: 0 5px;">[R | T]</span>
                            <span style="font-size: 1.5em; margin: 0 8px;">·</span>
                            <span class="matrix">
                                [Xʷ]<br>
                                [Yʷ]<br>
                                [Zʷ]<br>
                                [1]
                            </span>
                        </div>
                        <div style="margin-top: 20px; text-align: center; color: #aaa; font-size: 0.9rem;">
                            齐次坐标下的完整投影变换
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>内参矩阵 K：</strong></p>
                        <div class="matrix-display">
                            K = <span class="matrix" style="font-size: 1.1rem; padding: 20px;">
                                [f<sub>x</sub>&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;u₀]<br>
                                [&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;f<sub>y</sub>&nbsp;&nbsp;&nbsp;&nbsp;v₀]<br>
                                [&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;]
                            </span>
                        </div>
                        <p><strong>外参矩阵 [R | T]：</strong></p>
                        <div class="matrix-display">
                            [R | T] = <span class="matrix" style="font-size: 1rem; padding: 20px;">
                                [r₁₁&nbsp;&nbsp;r₁₂&nbsp;&nbsp;r₁₃&nbsp;&nbsp;|&nbsp;&nbsp;tₓ]<br>
                                [r₂₁&nbsp;&nbsp;r₂₂&nbsp;&nbsp;r₂₃&nbsp;&nbsp;|&nbsp;&nbsp;tᵧ]<br>
                                [r₃₁&nbsp;&nbsp;r₃₂&nbsp;&nbsp;r₃₃&nbsp;&nbsp;|&nbsp;&nbsp;tᵤ]
                            </span>
                        </div>
                        <p><strong>参数说明：</strong></p>
                        <p>• f<sub>x</sub> = f/dₓ, f<sub>y</sub> = f/dᵧ：像素焦距</p>
                        <p>• (u₀, v₀)：主点在像素坐标系中的坐标</p>
                        <p>• R：3×3 旋转矩阵，T：3×1 平移向量</p>
                        <p>• 完整的投影矩阵 P = K[R | T] 是 3×4 矩阵</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>5️⃣ 逆变换（深度估计）</h3>
                <div class="formula-box">
                    <div class="formula-title">从像素坐标恢复3D信息</div>
                    <div class="formula">
                        <div class="inverse-steps">
                            <div class="inv-step">
                                <strong>步骤1:</strong> 像素 → 图像坐标
                                <div class="inv-formula">
                                    x = (u - u₀) · dₓ<br>
                                    y = (v - v₀) · dᵧ
                                </div>
                            </div>
                            <div class="inv-step">
                                <strong>步骤2:</strong> 图像 → 相机坐标（需要深度Z）
                                <div class="inv-formula">
                                    Xᶜ = x · Z/f<br>
                                    Yᶜ = y · Z/f<br>
                                    Zᶜ = Z
                                </div>
                            </div>
                            <div class="inv-step">
                                <strong>步骤3:</strong> 相机 → 世界坐标
                                <div class="inv-formula">
                                    [Xʷ, Yʷ, Zʷ]ᵀ = R⁻¹([Xᶜ, Yᶜ, Zᶜ]ᵀ - T)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>关键问题：</strong>从单张图像无法直接获得深度信息Z</p>
                        <p><strong>解决方案：</strong></p>
                        <p>• 立体视觉：使用两个相机进行三角测量</p>
                        <p>• 深度传感器：结合RGB-D相机</p>
                        <p>• 先验知识：已知物体尺寸或场景约束</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>6️⃣ 详细数学推导过程</h3>
                <div class="formula-box">
                    <div class="formula-title">完整的坐标变换链</div>
                    <div class="formula">
                        <div style="margin: 20px 0; text-align: left;">
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤1: 世界 → 相机坐标</strong>
                                <div class="matrix-display" style="margin: 10px 0;">
                                    <span class="matrix" style="font-size: 1rem;">
                                        [Xᶜ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[r₁₁&nbsp;&nbsp;r₁₂&nbsp;&nbsp;r₁₃]&nbsp;&nbsp;&nbsp;[Xʷ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[tₓ]<br>
                                        [Yᶜ] = [r₂₁&nbsp;&nbsp;r₂₂&nbsp;&nbsp;r₂₃] × [Yʷ] + [tᵧ]<br>
                                        [Zᶜ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[r₃₁&nbsp;&nbsp;r₃₂&nbsp;&nbsp;r₃₃]&nbsp;&nbsp;&nbsp;[Zʷ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[tᵤ]
                                    </span>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤2: 相机 → 图像坐标</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    x = f × (Xᶜ / Zᶜ)<br>
                                    y = f × (Yᶜ / Zᶜ)
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong style="color: #4CAF50;">步骤3: 图像 → 像素坐标</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    u = (x / dₓ) + u₀ = (f × Xᶜ) / (dₓ × Zᶜ) + u₀<br>
                                    v = (y / dᵧ) + v₀ = (f × Yᶜ) / (dᵧ × Zᶜ) + v₀
                                </div>
                            </div>
                            <div style="background: rgba(76, 175, 80, 0.2); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid #4CAF50;">
                                <strong style="color: #4CAF50;">最终结果: 合并表达式</strong>
                                <div style="margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.1rem;">
                                    u = (f<sub>x</sub> × Xᶜ) / Zᶜ + u₀<br>
                                    v = (f<sub>y</sub> × Yᶜ) / Zᶜ + v₀
                                </div>
                                <div style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
                                    其中：f<sub>x</sub> = f/dₓ, f<sub>y</sub> = f/dᵧ
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>关键理解：</strong></p>
                        <p>• 每个步骤都是可逆的（除了深度信息的丢失）</p>
                        <p>• 旋转和平移是刚体变换，保持形状和大小不变</p>
                        <p>• 透视投影是非线性变换，远处物体看起来更小</p>
                        <p>• 像素化是离散化过程，可能引入量化误差</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="formula-derivation">
            <h2>⚠️ 误差分析与精度考虑</h2>
            
            <div class="derivation-section">
                <h3>🎯 主要误差来源</h3>
                <div class="formula-box">
                    <div class="formula-title">坐标变换中的误差传播</div>
                    <div class="formula-detail">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                            <div style="background: rgba(255, 99, 71, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #FF6347;">
                                <h4 style="color: #FF6347; margin-bottom: 10px;">🔧 标定误差</h4>
                                <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                                    • 焦距 f 的测量误差<br>
                                    • 主点 (u₀, v₀) 的定位误差<br>
                                    • 镜头畸变参数误差<br>
                                    • 旋转矩阵 R 的估计误差
                                </p>
                            </div>
                            <div style="background: rgba(255, 165, 0, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #FFA500;">
                                <h4 style="color: #FFA500; margin-bottom: 10px;">📏 量化误差</h4>
                                <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                                    • 像素离散化误差（±0.5像素）<br>
                                    • A/D转换精度限制<br>
                                    • 浮点运算舍入误差<br>
                                    • 像素尺寸的制造公差
                                </p>
                            </div>
                            <div style="background: rgba(255, 20, 147, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #FF1493;">
                                <h4 style="color: #FF1493; margin-bottom: 10px;">🌊 环境因素</h4>
                                <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                                    • 温度变化引起的焦距变化<br>
                                    • 振动导致的相机姿态变化<br>
                                    • 光照变化影响特征检测<br>
                                    • 大气折射（远距离测量）
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>📊 精度分析公式</h3>
                <div class="formula-box">
                    <div class="formula-title">深度测量精度</div>
                    <div class="formula">
                        <div style="background: rgba(76, 175, 80, 0.15); padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <div style="font-size: 1.2rem; margin-bottom: 15px; text-align: center;">
                                σ<sub>Z</sub> = <div class="fraction-inline" style="font-size: 1.1rem;"><span class="numerator">Z²</span><span class="denominator">f × B</span></div> × σ<sub>d</sub>
                            </div>
                            <div style="text-align: center; font-size: 0.9rem; color: #aaa;">
                                深度测量误差与距离的平方成正比
                            </div>
                        </div>
                    </div>
                    <div class="formula-detail">
                        <p><strong>参数说明：</strong></p>
                        <p>• σ<sub>Z</sub>：深度测量的标准差</p>
                        <p>• Z：目标物体的实际深度</p>
                        <p>• f：相机焦距</p>
                        <p>• B：基线距离（双目相机间距）</p>
                        <p>• σ<sub>d</sub>：视差测量的标准差（通常为0.1-1像素）</p>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>🎲 蒙特卡洛误差仿真</h3>
                <div class="formula-box">
                    <div class="formula-title">交互式精度计算器</div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">焦距 f (mm):</label>
                                <input type="range" id="focalError" min="10" max="100" value="50" style="width: 100%;">
                                <span id="focalErrorValue" style="color: #4CAF50;">50</span>
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">基线距离 B (mm):</label>
                                <input type="range" id="baselineError" min="50" max="200" value="100" style="width: 100%;">
                                <span id="baselineErrorValue" style="color: #4CAF50;">100</span>
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">目标深度 Z (mm):</label>
                                <input type="range" id="depthError" min="500" max="5000" value="1000" style="width: 100%;">
                                <span id="depthErrorValue" style="color: #4CAF50;">1000</span>
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">视差误差 σ_d (pixels):</label>
                                <input type="range" id="disparityError" min="0.1" max="2" step="0.1" value="0.5" style="width: 100%;">
                                <span id="disparityErrorValue" style="color: #4CAF50;">0.5</span>
                            </div>
                        </div>
                        <button onclick="calculateError()" style="background: #FF6347; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            计算测量精度
                        </button>
                        <div id="errorResult" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            点击按钮计算测量精度...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="formula-derivation">
            <h2>🧰 实用工具箱</h2>
            
            <div class="derivation-section">
                <h3>🔄 逆向工程：从像素反推世界坐标</h3>
                <div class="formula-box">
                    <div class="formula-title">已知深度的3D重建</div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">像素坐标 u:</label>
                                <input type="number" id="pixelU" value="400" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">像素坐标 v:</label>
                                <input type="number" id="pixelV" value="300" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">已知深度 Z (mm):</label>
                                <input type="number" id="knownDepth" value="1000" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <div>
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">焦距 f (mm):</label>
                                <input type="number" id="focalReverse" value="50" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                        </div>
                        <button onclick="reverseProject()" style="background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            反向投影计算
                        </button>
                        <div id="reverseResult" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            输入参数后点击计算...
                        </div>
                    </div>
                </div>
            </div>

            <div class="derivation-section">
                <h3>📐 相机标定参数计算器</h3>
                <div class="formula-box">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">📊 视场角计算</h4>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">传感器宽度 (mm):</label>
                                <input type="number" id="sensorWidth" value="36" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">焦距 (mm):</label>
                                <input type="number" id="focalFOV" value="50" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <button onclick="calculateFOV()" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; width: 100%;">
                                计算视场角
                            </button>
                            <div id="fovResult" style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
                                点击计算...
                            </div>
                        </div>

                        <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #4CAF50;">
                            <h4 style="color: #4CAF50; margin-bottom: 15px;">🎯 地面分辨率</h4>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">飞行高度 (m):</label>
                                <input type="number" id="altitude" value="100" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; color: #ccc; margin-bottom: 5px;">像素尺寸 (μm):</label>
                                <input type="number" id="pixelSize" value="5.5" style="width: 100%; padding: 8px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white;">
                            </div>
                            <button onclick="calculateGSD()" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; width: 100%;">
                                计算地面分辨率
                            </button>
                            <div id="gsdResult" style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
                                点击计算...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-demo">
            <h2>🧮 交互式坐标转换演示</h2>
            <div class="demo-controls">
                <div class="control-group">
                    <label>世界坐标 X:</label>
                    <input type="number" id="worldX" placeholder="100" value="100">
                </div>
                <div class="control-group">
                    <label>世界坐标 Y:</label>
                    <input type="number" id="worldY" placeholder="50" value="50">
                </div>
                <div class="control-group">
                    <label>世界坐标 Z:</label>
                    <input type="number" id="worldZ" placeholder="200" value="200">
                </div>
                <div class="control-group">
                    <label>焦距 f:</label>
                    <input type="number" id="focal" placeholder="500" value="500">
                </div>
                <button onclick="calculateTransform()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">计算转换</button>
            </div>
            <div class="demo-result" id="result">
                点击"计算转换"查看坐标变换结果...
            </div>
        </div>

        <div class="formula-derivation">
            <h2>📋 公式速查表</h2>
            
            <div class="derivation-section">
                <div class="formula-box">
                    <div class="formula-title">立体视觉核心公式总览</div>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                            <thead>
                                <tr style="background: rgba(102, 126, 234, 0.2);">
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">变换类型</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">公式</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">用途</th>
                                    <th style="padding: 15px; text-align: left; color: #667eea; border-bottom: 2px solid #667eea;">误差特性</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">世界→相机</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">P<sub>c</sub> = R·P<sub>w</sub> + T</td>
                                    <td style="padding: 12px; color: #ccc;">坐标系转换</td>
                                    <td style="padding: 12px; color: #FFA500;">标定精度影响</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">相机→图像</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">x = f·X<sub>c</sub>/Z<sub>c</sub><br>y = f·Y<sub>c</sub>/Z<sub>c</sub></td>
                                    <td style="padding: 12px; color: #ccc;">透视投影</td>
                                    <td style="padding: 12px; color: #FF6347;">深度敏感</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #4CAF50;">图像→像素</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">u = f<sub>x</sub>·X<sub>c</sub>/Z<sub>c</sub> + u<sub>0</sub><br>v = f<sub>y</sub>·Y<sub>c</sub>/Z<sub>c</sub> + v<sub>0</sub></td>
                                    <td style="padding: 12px; color: #ccc;">数字化</td>
                                    <td style="padding: 12px; color: #9C27B0;">量化误差</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #2196F3;">深度估计</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">Z = f·B/d</td>
                                    <td style="padding: 12px; color: #ccc;">双目测距</td>
                                    <td style="padding: 12px; color: #FF6347;">误差∝Z²</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 12px; font-weight: bold; color: #FF6347;">深度精度</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">σ<sub>Z</sub> = Z²/(f·B)·σ<sub>d</sub></td>
                                    <td style="padding: 12px; color: #ccc;">误差分析</td>
                                    <td style="padding: 12px; color: #FF6347;">距离平方关系</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; font-weight: bold; color: #FFC107;">视场角</td>
                                    <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem;">FOV = 2·arctan(w/2f)</td>
                                    <td style="padding: 12px; color: #ccc;">系统设计</td>
                                    <td style="padding: 12px; color: #4CAF50;">线性关系</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                            <h4 style="color: #4CAF50; margin-bottom: 10px;">📏 常用参数范围</h4>
                            <div style="font-size: 0.9rem; color: #ccc; line-height: 1.6;">
                                • 焦距: 5-200mm<br>
                                • 基线: 50-300mm<br>
                                • 像素尺寸: 2-10μm<br>
                                • 视差精度: 0.1-1 pixel
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #FFC107;">
                            <h4 style="color: #FFC107; margin-bottom: 10px;">⚡ 优化建议</h4>
                            <div style="font-size: 0.9rem; color: #ccc; line-height: 1.6;">
                                • 增大基线提高深度精度<br>
                                • 长焦镜头减少畸变<br>
                                • 亚像素算法提升精度<br>
                                • 多尺度匹配增强鲁棒性
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="applications">
            <h2>🚀 实际应用领域</h2>
            <div class="app-grid">
                <div class="app-card">
                    <h3>🤖 机器人导航</h3>
                    <p>通过立体视觉获取环境深度信息，实现精确的路径规划和避障功能。</p>
                </div>
                <div class="app-card">
                    <h3>🚗 自动驾驶</h3>
                    <p>识别道路、车辆、行人的3D位置，为安全驾驶决策提供关键信息。</p>
                </div>
                <div class="app-card">
                    <h3>🏥 医学成像</h3>
                    <p>在手术导航和诊断中，精确定位器官和病变的空间位置。</p>
                </div>
                <div class="app-card">
                    <h3>🎮 增强现实</h3>
                    <p>将虚拟物体准确地放置在真实世界中，创造沉浸式体验。</p>
                </div>
                <div class="app-card">
                    <h3>🏭 工业检测</h3>
                    <p>自动化质量控制中的精密测量和缺陷检测。</p>
                </div>
                <div class="app-card">
                    <h3>📱 人脸识别</h3>
                    <p>3D人脸建模和识别，提高安全性和准确性。</p>
                </div>
            </div>
        </div>

        <!-- 页脚导航 -->
        <footer style="background: rgba(0, 0, 0, 0.9); padding: 40px 0; margin-top: 60px;">
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h3 style="color: white; margin-bottom: 15px;">3D Camera World</h3>
                        <p style="color: rgba(255, 255, 255, 0.7); max-width: 300px;">
                            探索立体视觉和3D成像技术的奇妙世界
                        </p>
                    </div>
                    <div>
                        <h4 style="color: white; margin-bottom: 15px;">快速导航</h4>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <a href="index.html" style="color: rgba(255, 255, 255, 0.8); text-decoration: none; transition: color 0.3s;">🏠 主页</a>
                            <a href="stereo_vision_coordinates.html" style="color: #667eea; text-decoration: none; transition: color 0.3s;">📐 坐标系统</a>
                            <a href="updated_laser_triangulation.html" style="color: rgba(255, 255, 255, 0.8); text-decoration: none; transition: color 0.3s;">📡 激光三角</a>
                            <a href="index.html#applications" style="color: rgba(255, 255, 255, 0.8); text-decoration: none; transition: color 0.3s;">🚀 应用领域</a>
                        </div>
                    </div>
                    <div>
                        <a href="index.html" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.3s ease; font-weight: 500;">
                            ← 返回主页
                        </a>
                    </div>
                </div>
                <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 30px; padding-top: 20px; text-align: center;">
                    <p style="color: rgba(255, 255, 255, 0.5); margin: 0;">
                        © 2024 3D Camera World - 专业的立体视觉科普平台
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        function toggleDetails(coordType) {
            const details = document.getElementById(coordType + '-details');
            const card = details.parentElement;
            
            // Close all other details
            document.querySelectorAll('.coord-details').forEach(detail => {
                if (detail !== details) {
                    detail.classList.remove('show');
                    detail.parentElement.classList.remove('active');
                }
            });
            
            // Toggle current details
            details.classList.toggle('show');
            card.classList.toggle('active');
        }

        function calculateTransform() {
            const worldX = parseFloat(document.getElementById('worldX').value) || 100;
            const worldY = parseFloat(document.getElementById('worldY').value) || 50;
            const worldZ = parseFloat(document.getElementById('worldZ').value) || 200;
            const focal = parseFloat(document.getElementById('focal').value) || 500;
            
            // 简化的变换计算（假设相机坐标系与世界坐标系重合）
            const cameraX = worldX;
            const cameraY = worldY;
            const cameraZ = worldZ;
            
            // 透视投影
            const imageX = (focal * cameraX / cameraZ).toFixed(2);
            const imageY = (focal * cameraY / cameraZ).toFixed(2);
            
            // 转换到像素坐标（假设像素大小为0.01mm，主点在图像中心）
            const pixelU = Math.round(parseFloat(imageX) / 0.01 + 320);
            const pixelV = Math.round(parseFloat(imageY) / 0.01 + 240);

            // 计算像素焦距
            const focalX = (focal / 0.01).toFixed(0);
            const focalY = (focal / 0.01).toFixed(0);
            
            const resultHTML = `
                <h3>🎯 完整坐标变换计算过程：</h3>
                <div class="calc-steps">
                    <div class="calc-step">
                        <strong>0. 输入参数</strong>
                        <div class="calc-formula">
                            世界坐标: P<sub>w</sub> = (${worldX}, ${worldY}, ${worldZ}) mm<br>
                            相机焦距: f = ${focal} mm<br>
                            像素尺寸: dₓ = dᵧ = 0.01 mm/pixel<br>
                            主点坐标: (u₀, v₀) = (320, 240) pixels
                        </div>
                    </div>
                    <div class="calc-step">
                        <strong>1. 世界坐标 → 相机坐标</strong>
                        <div class="calc-formula">
                            简化假设：R = I (单位矩阵), T = 0 (零向量)<br>
                            P<sub>c</sub> = R·P<sub>w</sub> + T = P<sub>w</sub>
                        </div>
                        <div class="calc-result">相机坐标: (${cameraX}, ${cameraY}, ${cameraZ}) mm</div>
                    </div>
                    <div class="calc-step">
                        <strong>2. 相机坐标 → 图像坐标（透视投影）</strong>
                        <div class="calc-formula">
                            x = f × (Xᶜ/Zᶜ) = ${focal} × (${cameraX}/${cameraZ}) = ${imageX} mm<br>
                            y = f × (Yᶜ/Zᶜ) = ${focal} × (${cameraY}/${cameraZ}) = ${imageY} mm
                        </div>
                        <div class="calc-result">图像坐标: (${imageX}, ${imageY}) mm</div>
                    </div>
                    <div class="calc-step">
                        <strong>3. 图像坐标 → 像素坐标</strong>
                        <div class="calc-formula">
                            fₓ = f/dₓ = ${focal}/0.01 = ${focalX} pixels<br>
                            fᵧ = f/dᵧ = ${focal}/0.01 = ${focalY} pixels<br>
                            u = (fₓ × Xᶜ)/Zᶜ + u₀ = (${focalX} × ${cameraX})/${cameraZ} + 320 = ${pixelU}<br>
                            v = (fᵧ × Yᶜ)/Zᶜ + v₀ = (${focalY} × ${cameraY})/${cameraZ} + 240 = ${pixelV}
                        </div>
                        <div class="calc-result">最终像素坐标: (${pixelU}, ${pixelV}) pixels</div>
                    </div>
                </div>
                <div class="calc-params">
                    <strong>📊 变换总结：</strong><br>
                    • 输入：世界坐标 (${worldX}, ${worldY}, ${worldZ}) mm<br>
                    • 输出：像素坐标 (${pixelU}, ${pixelV}) pixels<br>
                    • 深度损失：从3D → 2D，Z坐标信息丢失<br>
                    • 投影效果：${worldZ > 100 ? '物体较远，投影较小' : '物体较近，投影较大'}
                </div>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #4CAF50;">
                    <strong style="color: #4CAF50;">🔍 验证检查：</strong><br>
                    • 透视效果：视差 = f × B / Z = ${focal} × 100 / ${worldZ} = ${(focal * 100 / worldZ).toFixed(2)} pixels<br>
                    • 角分辨率：1 pixel ≈ ${(0.01 / focal * 180 / Math.PI * 3600).toFixed(2)} 角秒<br>
                    • 测量精度：在${worldZ}mm距离处，1像素对应 ${(worldZ * 0.01 / focal).toFixed(3)}mm
                </div>
            `;
            
            document.getElementById('result').innerHTML = resultHTML;
        }

        function calculateError() {
            const focal = parseFloat(document.getElementById('focalError').value);
            const baseline = parseFloat(document.getElementById('baselineError').value);
            const depth = parseFloat(document.getElementById('depthError').value);
            const disparityError = parseFloat(document.getElementById('disparityError').value);
            
            // 输入验证
            if (focal <= 0 || baseline <= 0 || depth <= 0 || disparityError < 0) {
                document.getElementById('errorResult').innerHTML = `
                    <div style="color: #FF6347; padding: 15px; background: rgba(255, 99, 71, 0.1); border-radius: 8px;">
                        ⚠️ 错误：所有参数必须为正数，视差误差不能为负数
                    </div>
                `;
                return;
            }
            
            // 更新显示值
            document.getElementById('focalErrorValue').textContent = focal;
            document.getElementById('baselineErrorValue').textContent = baseline;
            document.getElementById('depthErrorValue').textContent = depth;
            document.getElementById('disparityErrorValue').textContent = disparityError;
            
            // 计算视差值 (加入除零保护)
            const disparity = (focal * baseline) / depth;
            
            // 除零保护：如果计算出的视差太小，给出警告
            if (disparity < 0.1) {
                document.getElementById('errorResult').innerHTML = `
                    <div style="color: #FFA500; padding: 15px; background: rgba(255, 165, 0, 0.1); border-radius: 8px;">
                        ⚠️ 警告：计算出的视差值过小 (${disparity.toFixed(4)} pixels)，测量精度可能极低。
                        建议减小测量距离或增大基线距离。
                    </div>
                `;
                return;
            }
            
            // 计算深度测量误差
            const depthError = (depth * depth) / (focal * baseline) * disparityError;
            const relativeError = (depthError / depth * 100);
            
            // 计算横向位置误差
            const lateralError = depth / focal * disparityError;
            
            // 计算角分辨率
            const angularResolution = Math.atan(0.01 / focal) * 180 / Math.PI * 3600; // 角秒
            
            const resultHTML = `
                <h4 style="color: #FF6347; margin-bottom: 15px;">📊 精度分析结果</h4>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                        <strong style="color: #4CAF50;">深度精度</strong><br>
                        绝对误差: ±${depthError.toFixed(2)} mm<br>
                        相对误差: ±${relativeError.toFixed(2)}%<br>
                        <span style="font-size: 0.8rem; color: #aaa;">σ_Z = Z²/(f×B) × σ_d</span>
                    </div>
                    
                    <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #FFC107;">
                        <strong style="color: #FFC107;">横向精度</strong><br>
                        X/Y方向误差: ±${lateralError.toFixed(2)} mm<br>
                        角分辨率: ${angularResolution.toFixed(1)} 角秒<br>
                        <span style="font-size: 0.8rem; color: #aaa;">σ_XY = Z/f × σ_d</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                    <strong>💡 系统参数分析：</strong><br>
                    • 计算视差: ${disparity.toFixed(2)} pixels<br>
                    • 基线/深度比: ${(baseline/depth).toFixed(4)}<br>
                    • 焦距/像素比: ${(focal/0.01).toFixed(0)}<br>
                    • 建议：${relativeError > 5 ? '增加基线距离或降低测量距离' : '当前配置精度良好'}
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: rgba(255, 99, 71, 0.1); border-radius: 8px; border-left: 4px solid #FF6347;">
                    <strong style="color: #FF6347;">⚠️ 误差影响因素排序：</strong><br>
                    1. 深度距离 (误差∝Z²) - 影响最大<br>
                    2. 基线距离 (误差∝1/B) - 关键参数<br>
                    3. 焦距长度 (误差∝1/f) - 重要因素<br>
                    4. 视差精度 (误差∝σ_d) - 基础误差
                </div>
            `;
            
            document.getElementById('errorResult').innerHTML = resultHTML;
        }

        function reverseProject() {
            const u = parseFloat(document.getElementById('pixelU').value) || 400;
            const v = parseFloat(document.getElementById('pixelV').value) || 300;
            const Z = parseFloat(document.getElementById('knownDepth').value) || 1000;
            const f = parseFloat(document.getElementById('focalReverse').value) || 50;
            
            // 相机参数（假设值）
            const u0 = 320, v0 = 240;  // 主点
            const dx = 0.01, dy = 0.01;  // 像素尺寸 mm
            
            // 逆向投影计算
            const x = (u - u0) * dx;  // 图像坐标
            const y = (v - v0) * dy;
            
            const Xc = x * Z / f;  // 相机坐标
            const Yc = y * Z / f;
            const Zc = Z;
            
            // 假设相机坐标系与世界坐标系重合
            const Xw = Xc, Yw = Yc, Zw = Zc;
            
            const resultHTML = `
                <h4 style="color: #2196F3; margin-bottom: 15px;">🔄 逆向投影结果</h4>
                
                <div style="background: rgba(33, 150, 243, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>🎯 计算步骤：</strong><br>
                    <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; margin: 10px 0; line-height: 1.6;">
                        步骤1: 像素 → 图像坐标<br>
                        x = (${u} - ${u0}) × ${dx} = ${x.toFixed(3)} mm<br>
                        y = (${v} - ${v0}) × ${dy} = ${y.toFixed(3)} mm<br><br>
                        
                        步骤2: 图像 → 相机坐标<br>
                        Xᶜ = ${x.toFixed(3)} × ${Z}/${f} = ${Xc.toFixed(2)} mm<br>
                        Yᶜ = ${y.toFixed(3)} × ${Z}/${f} = ${Yc.toFixed(2)} mm<br>
                        Zᶜ = ${Zc} mm<br><br>
                        
                        步骤3: 相机 → 世界坐标<br>
                        [Xʷ, Yʷ, Zʷ] = [${Xw.toFixed(2)}, ${Yw.toFixed(2)}, ${Zw}] mm
                    </div>
                </div>
                
                <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <strong style="color: #4CAF50;">✅ 最终结果：</strong><br>
                    世界坐标: (${Xw.toFixed(2)}, ${Yw.toFixed(2)}, ${Zw}) mm<br>
                    距离光轴: ${Math.sqrt(Xw*Xw + Yw*Yw).toFixed(2)} mm<br>
                    视角: ${(Math.atan2(Math.sqrt(Xw*Xw + Yw*Yw), Zw) * 180 / Math.PI).toFixed(2)}°
                </div>
            `;
            
            document.getElementById('reverseResult').innerHTML = resultHTML;
        }

        function calculateFOV() {
            const sensorWidth = parseFloat(document.getElementById('sensorWidth').value) || 36;
            const focal = parseFloat(document.getElementById('focalFOV').value) || 50;
            
            const fovRad = 2 * Math.atan(sensorWidth / (2 * focal));
            const fovDeg = fovRad * 180 / Math.PI;
            
            const hyperfocal = (focal * focal) / (2 * 0.03);  // 假设弥散圆0.03mm
            
            document.getElementById('fovResult').innerHTML = `
                水平视场角: ${fovDeg.toFixed(1)}°<br>
                超焦距: ${(hyperfocal/1000).toFixed(1)} m<br>
                <span style="color: #667eea;">FOV = 2×arctan(${sensorWidth}/2×${focal})</span>
            `;
        }

        function calculateGSD() {
            const altitude = parseFloat(document.getElementById('altitude').value) || 100;
            const pixelSize = parseFloat(document.getElementById('pixelSize').value) || 5.5;
            const focal = parseFloat(document.getElementById('focalFOV').value) || 50;
            
            const gsd = (altitude * 1000 * pixelSize / 1000) / focal;  // cm/pixel
            const coverageWidth = gsd * 4000 / 100;  // 假设4000像素宽度，转换为米
            
            document.getElementById('gsdResult').innerHTML = `
                地面分辨率: ${gsd.toFixed(2)} cm/pixel<br>
                覆盖宽度: ${coverageWidth.toFixed(1)} m<br>
                <span style="color: #4CAF50;">GSD = H×p/f</span>
            `;
        }

        // 页面加载时的动画效果
        window.addEventListener('load', function() {
            const cards = document.querySelectorAll('.coord-card');
            cards.forEach((card, index) => {
                card.style.animation = `fadeIn 0.6s ease ${index * 0.1}s forwards`;
                card.style.opacity = '0';
            });
        });

        // 添加 CSS 动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>