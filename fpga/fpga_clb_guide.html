<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPGA可配置逻辑块 - 科普介绍</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .section h2 {
            color: #4a5568;
            font-size: 2rem;
            margin-bottom: 20px;
            position: relative;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .fpga-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .clb {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .clb:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
        }

        .clb.active {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .clb-label {
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
        }

        .interactive-demo {
            background: #2d3748;
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .demo-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .lut-demo, .ff-demo {
            background: #1a202c;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
        }

        .lut-visual, .ff-visual {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            align-items: center;
            margin: 20px 0;
        }

        .lut-inputs, .ff-inputs, .ff-outputs {
            background: #2d3748;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .input-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .input-group label {
            font-weight: bold;
            min-width: 80px;
        }

        .input-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #e53e3e;
            color: white;
        }

        .input-btn.active {
            background: #38a169;
            transform: scale(1.1);
        }

        .clock-btn {
            background: #3182ce !important;
        }

        .clock-btn.active {
            background: #2b6cb0 !important;
            box-shadow: 0 0 20px rgba(49, 130, 206, 0.6);
        }

        .address-display {
            margin-top: 15px;
            padding: 10px;
            background: #4a5568;
            border-radius: 5px;
            font-family: monospace;
            font-size: 18px;
        }

        .lut-memory {
            text-align: center;
        }

        .memory-array {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .memory-cell {
            background: #2d3748;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 16px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .memory-cell.active {
            background: #f56565;
            border-color: #fc8181;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(245, 101, 101, 0.5);
        }

        .lut-output {
            text-align: center;
        }

        .output-display {
            width: 80px;
            height: 80px;
            background: #2d3748;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            margin: 0 auto 15px;
            transition: all 0.3s ease;
            border: 4px solid #4a5568;
        }

        .output-display.high {
            background: #38a169;
            border-color: #48bb78;
            box-shadow: 0 0 20px rgba(56, 161, 105, 0.5);
        }

        .logic-function {
            font-size: 18px;
            font-weight: bold;
            color: #81c784;
        }

        .ff-core {
            text-align: center;
        }

        .ff-symbol {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .ff-box {
            width: 120px;
            height: 80px;
            background: #2d3748;
            border: 3px solid #4a5568;
            border-radius: 10px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ff-label {
            position: absolute;
            left: -30px;
            background: #4a5568;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .ff-clock {
            position: absolute;
            bottom: -30px;
            background: #3182ce;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }

        .ff-output {
            position: absolute;
            right: -30px;
            background: #38a169;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }

        .ff-state {
            margin: 15px 0;
            font-size: 18px;
        }

        .state-value {
            font-family: monospace;
            font-size: 24px;
            font-weight: bold;
            color: #81c784;
        }

        .ff-outputs {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .output-labels {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .output-labels div {
            font-size: 18px;
            font-weight: bold;
        }

        .timing-diagram {
            margin: 25px 0;
            background: #2d3748;
            padding: 20px;
            border-radius: 10px;
        }

        .timing-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .timing-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .signal-label {
            min-width: 40px;
            font-weight: bold;
            font-family: monospace;
        }

        .timing-wave {
            flex: 1;
            height: 40px;
            background: #1a202c;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .wave-segment {
            position: absolute;
            height: 100%;
            background: #38a169;
            transition: all 0.3s ease;
        }

        .wave-segment.low {
            top: 50%;
            height: 50%;
        }

        .wave-segment.high {
            top: 0;
            height: 50%;
        }

        @media (max-width: 768px) {
            .lut-visual, .ff-visual {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .timing-row {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .comparison-table tr:hover {
            background: #f7fafc;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .logic-type-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .logic-type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .logic-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .logic-example {
            background: #1a202c;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .logic-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .logic-component {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            white-space: nowrap;
        }

        .combinational-comp {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #f56565;
        }

        .sequential-comp {
            background: #bee3f8;
            color: #2b6cb0;
            border: 2px solid #4299e1;
        }

        .clock-comp {
            background: #3182ce;
            color: white;
            border: 2px solid #2b6cb0;
        }

        .flow-arrow {
            font-size: 20px;
            color: #4a5568;
        }

        @media (max-width: 768px) {
            .logic-comparison {
                grid-template-columns: 1fr;
            }
            
            .logic-flow {
                flex-direction: column;
                gap: 10px;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
        }

        .logic-type-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .logic-type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .logic-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .logic-example {
            background: #1a202c;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .logic-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .logic-component {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            white-space: nowrap;
        }

        .combinational-comp {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #f56565;
        }

        .sequential-comp {
            background: #bee3f8;
            color: #2b6cb0;
            border: 2px solid #4299e1;
        }

        .clock-comp {
            background: #3182ce;
            color: white;
            border: 2px solid #2b6cb0;
        }

        .flow-arrow {
            font-size: 20px;
            color: #4a5568;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .section {
                padding: 20px;
            }
            
            .fpga-demo {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
            
            .clb {
                width: 60px;
                height: 60px;
            }
            
            .logic-comparison {
                grid-template-columns: 1fr;
            }
            
            .logic-flow {
                flex-direction: column;
                gap: 10px;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>FPGA 可配置逻辑块与数字逻辑基础</h1>
            <p>深入了解现代数字系统的核心技术 - 组合逻辑与时序逻辑</p>
        </div>

        <div class="section">
            <h2>什么是FPGA？</h2>
            <p>FPGA（Field-Programmable Gate Array，现场可编程门阵列）是一种可以通过编程来重新配置的集成电路。它由大量的可配置逻辑块（CLB）组成，这些逻辑块可以实现各种数字逻辑功能。</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-icon">⚡</span>
                    <h3>高性能并行处理</h3>
                    <p>专为并行计算优化，适合处理大量数据</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🔧</span>
                    <h3>灵活可重配置</h3>
                    <p>可以根据需要重新编程，实现不同功能</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🚀</span>
                    <h3>快速原型开发</h3>
                    <p>缩短产品开发周期，快速验证设计</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>可配置逻辑块 (CLB) 结构</h2>
            <p>CLB是FPGA的基本构建单元，每个CLB包含查找表（LUT）、触发器和多路选择器等组件。</p>
            
            <div class="fpga-demo" id="fpgaDemo">
                <!-- CLB blocks will be generated by JavaScript -->
            </div>
            
            <div class="interactive-demo">
                <h3>🎮 交互式CLB演示</h3>
                <p>点击下面的按钮来查看不同的CLB配置模式：</p>
                <div class="demo-controls">
                    <button class="btn" onclick="demonstratePattern('sequential')">顺序激活</button>
                    <button class="btn" onclick="demonstratePattern('random')">随机激活</button>
                    <button class="btn" onclick="demonstratePattern('grid')">网格模式</button>
                    <button class="btn" onclick="demonstratePattern('clear')">清除所有</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>数字逻辑基础：组合逻辑与时序逻辑</h2>
            <p>在深入了解CLB之前，我们需要理解数字电路的两种基本类型：组合逻辑和时序逻辑。CLB中的LUT实现组合逻辑，而触发器实现时序逻辑。</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-icon">⚡</span>
                    <h3>组合逻辑 (Combinational Logic)</h3>
                    <p>输出仅依赖于当前输入，无记忆功能</p>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>与门 (AND)</li>
                        <li>或门 (OR)</li>
                        <li>非门 (NOT)</li>
                        <li>异或门 (XOR)</li>
                        <li>编码器、解码器</li>
                        <li>多路选择器</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🕒</span>
                    <h3>时序逻辑 (Sequential Logic)</h3>
                    <p>输出依赖于当前输入和历史状态，具有记忆功能</p>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>触发器 (Flip-flop)</li>
                        <li>锁存器 (Latch)</li>
                        <li>计数器 (Counter)</li>
                        <li>移位寄存器</li>
                        <li>状态机</li>
                        <li>存储器</li>
                    </ul>
                </div>
            </div>

            <div class="comparison-table" style="margin-top: 30px;">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>特性</th>
                            <th>组合逻辑</th>
                            <th>时序逻辑</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>记忆能力</td>
                            <td>❌ 无状态</td>
                            <td>✅ 有状态记忆</td>
                        </tr>
                        <tr>
                            <td>时钟依赖</td>
                            <td>❌ 不需要时钟</td>
                            <td>✅ 需要时钟同步</td>
                        </tr>
                        <tr>
                            <td>响应速度</td>
                            <td>⚡ 即时响应</td>
                            <td>🕒 时钟边沿响应</td>
                        </tr>
                        <tr>
                            <td>输出特点</td>
                            <td>输出仅取决于当前输入</td>
                            <td>输出取决于输入和当前状态</td>
                        </tr>
                        <tr>
                            <td>典型应用</td>
                            <td>数据处理、运算</td>
                            <td>数据存储、控制</td>
                        </tr>
                        <tr>
                            <td>在CLB中的实现</td>
                            <td>📊 LUT (查找表)</td>
                            <td>🔄 触发器</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="interactive-demo" style="margin-top: 30px;">
                <h3>🔄 组合逻辑vs时序逻辑演示</h3>
                <p>下面的动画展示了组合逻辑和时序逻辑的不同响应方式：</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #1a202c; padding: 20px; border-radius: 10px; color: white;">
                        <h4>🔗 组合逻辑示例</h4>
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="display: inline-block; padding: 15px; background: #2d3748; border-radius: 8px; margin: 10px;">
                                输入A → [与门] → 输出
                            </div>
                            <div style="display: inline-block; padding: 15px; background: #2d3748; border-radius: 8px; margin: 10px;">
                                输入B ↗
                            </div>
                        </div>
                        <p style="font-size: 14px; opacity: 0.8;">输入变化时输出立即变化</p>
                    </div>
                    
                    <div style="background: #1a202c; padding: 20px; border-radius: 10px; color: white;">
                        <h4>⏰ 时序逻辑示例</h4>
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="display: inline-block; padding: 15px; background: #2d3748; border-radius: 8px; margin: 10px;">
                                输入D → [D触发器] → 输出Q
                            </div>
                            <div style="display: inline-block; padding: 15px; background: #3182ce; border-radius: 8px; margin: 10px;">
                                时钟CLK ↗
                            </div>
                        </div>
                        <p style="font-size: 14px; opacity: 0.8;">只在时钟边沿更新输出</p>
                    </div>
                </div>
                
                <div class="demo-controls">
                    <button class="btn" onclick="demonstrateLogicTypes('combinational')">🔗 组合逻辑动画</button>
                    <button class="btn" onclick="demonstrateLogicTypes('sequential')">⏰ 时序逻辑动画</button>
                    <button class="btn" onclick="demonstrateLogicTypes('both')">🔄 对比演示</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>CLB中的组合逻辑与时序逻辑集成</h2>
            <p>FPGA的CLB巧妙地将组合逻辑（LUT）和时序逻辑（触发器）集成在一起，通过可配置的连接实现复杂的数字系统。</p>
            
            <div class="clb-architecture">
                <h4>🏗️ CLB完整架构图</h4>
                <div style="background: #f7fafc; padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; align-items: center;">
                        
                        <!-- 输入端 -->
                        <div style="text-align: center;">
                            <h5 style="color: #4a5568; margin-bottom: 15px;">📥 输入信号</h5>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="padding: 12px; background: #e2e8f0; border-radius: 8px; border-left: 4px solid #667eea;">
                                    输入 A
                                </div>
                                <div style="padding: 12px; background: #e2e8f0; border-radius: 8px; border-left: 4px solid #667eea;">
                                    输入 B
                                </div>
                                <div style="padding: 12px; background: #e2e8f0; border-radius: 8px; border-left: 4px solid #667eea;">
                                    输入 C
                                </div>
                                <div style="padding: 12px; background: #bee3f8; border-radius: 8px; border-left: 4px solid #3182ce;">
                                    时钟 CLK
                                </div>
                            </div>
                        </div>
                        
                        <!-- CLB核心 -->
                        <div style="text-align: center;">
                            <h5 style="color: #4a5568; margin-bottom: 15px;">🔧 CLB核心</h5>
                            <div style="border: 3px solid #667eea; border-radius: 15px; padding: 20px; background: white;">
                                
                                <!-- LUT部分 -->
                                <div style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                    <strong>🔗 LUT (组合逻辑)</strong>
                                    <div style="font-size: 12px; margin-top: 5px;">查找表 - 无状态</div>
                                </div>
                                
                                <!-- 连接线 -->
                                <div style="height: 20px; border-left: 2px dashed #a0aec0; margin: 0 auto; width: 2px;"></div>
                                
                                <!-- 多路选择器 -->
                                <div style="background: #9f7aea; color: white; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 14px;">
                                    MUX 选择器
                                </div>
                                
                                <!-- 连接线 -->
                                <div style="height: 20px; border-left: 2px dashed #a0aec0; margin: 0 auto; width: 2px;"></div>
                                
                                <!-- 触发器部分 -->
                                <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #2d3748; padding: 15px; border-radius: 10px;">
                                    <strong>⏰ 触发器 (时序逻辑)</strong>
                                    <div style="font-size: 12px; margin-top: 5px;">D-FF - 有状态记忆</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 输出端 -->
                        <div style="text-align: center;">
                            <h5 style="color: #4a5568; margin-bottom: 15px;">📤 输出选择</h5>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="padding: 12px; background: #fed7d7; border-radius: 8px; border-left: 4px solid #f56565;">
                                    组合输出
                                    <div style="font-size: 12px; opacity: 0.7;">(直接来自LUT)</div>
                                </div>
                                <div style="padding: 12px; background: #c6f6d5; border-radius: 8px; border-left: 4px solid #38a169;">
                                    时序输出
                                    <div style="font-size: 12px; opacity: 0.7;">(来自触发器)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据流向箭头 -->
                    <div style="text-align: center; margin-top: 20px; color: #666;">
                        <div style="display: flex; justify-content: center; align-items: center; gap: 20px;">
                            <span>🔗 组合路径：输入 → LUT → 组合输出</span>
                        </div>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 10px;">
                            <span>⏰ 时序路径：输入 → LUT → 触发器 → 时序输出</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: #edf2f7; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h5 style="color: #2d3748; margin-bottom: 15px;">💡 关键设计理念</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #667eea;">
                            <strong>🔄 灵活路由</strong>
                            <p style="margin: 5px 0; font-size: 14px;">LUT输出可以直接输出（组合）或经过触发器（时序）</p>
                        </div>
                        <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #38a169;">
                            <strong>⚡ 高效并行</strong>
                            <p style="margin: 5px 0; font-size: 14px;">组合逻辑提供快速计算，时序逻辑提供同步控制</p>
                        </div>
                        <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #ed8936;">
                            <strong>🎯 用途多样</strong>
                            <p style="margin: 5px 0; font-size: 14px;">可配置为纯组合、纯时序或混合逻辑电路</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>查找表 (LUT) 原理</h2>
            <p>LUT是CLB的核心组件，它存储预定义的逻辑函数真值表。LUT本质上是一个小型的存储器，通过输入地址来查找对应的输出值。LUT实现的是<strong>组合逻辑</strong>，输出仅取决于当前输入。</p>
            
            <div class="lut-demo">
                <h4>🔍 交互式LUT演示</h4>
                <div class="lut-visual">
                    <div class="lut-inputs">
                        <h5>输入信号</h5>
                        <div class="input-controls">
                            <div class="input-group">
                                <label>A: </label>
                                <button class="input-btn" id="inputA" onclick="toggleInput('A')">0</button>
                            </div>
                            <div class="input-group">
                                <label>B: </label>
                                <button class="input-btn" id="inputB" onclick="toggleInput('B')">0</button>
                            </div>
                            <div class="input-group">
                                <label>C: </label>
                                <button class="input-btn" id="inputC" onclick="toggleInput('C')">0</button>
                            </div>
                        </div>
                        <div class="address-display">
                            <strong>地址: <span id="lutAddress">000</span></strong>
                        </div>
                    </div>
                    
                    <div class="lut-memory">
                        <h5>LUT存储器</h5>
                        <div class="memory-array" id="lutMemory">
                            <!-- Memory cells will be generated -->
                        </div>
                    </div>
                    
                    <div class="lut-output">
                        <h5>输出</h5>
                        <div class="output-display" id="lutOutput">0</div>
                        <div class="logic-function" id="logicFunction">AND门</div>
                    </div>
                </div>
                
                <div class="demo-controls">
                    <button class="btn" onclick="setLUTFunction('and')">AND门</button>
                    <button class="btn" onclick="setLUTFunction('or')">OR门</button>
                    <button class="btn" onclick="setLUTFunction('xor')">XOR门</button>
                    <button class="btn" onclick="setLUTFunction('majority')">多数决定</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>触发器 (Flip-Flop) 原理</h2>
            <p>触发器是存储单个比特信息的基本存储单元，在时钟信号的控制下实现数据的存储和传输。CLB中的触发器通常是D触发器，它实现<strong>时序逻辑</strong>，具有记忆功能，输出不仅取决于当前输入，还取决于先前的状态。</p>
            
            <div style="background: #e6fffa; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #38a169;">
                <h4 style="color: #2d3748; margin-bottom: 10px;">🔍 时序逻辑特点</h4>
                <ul style="color: #2d3748; margin: 0;">
                    <li><strong>状态存储：</strong> 能够保存1位二进制信息</li>
                    <li><strong>时钟同步：</strong> 只在时钟边沿（通常是上升沿）更新状态</li>
                    <li><strong>记忆功能：</strong> 在没有时钟时保持当前状态不变</li>
                    <li><strong>同步设计：</strong> 确保整个系统按统一节拍工作</li>
                </ul>
            </div>
            
            <div class="ff-demo">
                <h4>🕒 D触发器交互演示</h4>
                <div class="ff-visual">
                    <div class="ff-inputs">
                        <h5>控制信号</h5>
                        <div class="input-controls">
                            <div class="input-group">
                                <label>D (数据): </label>
                                <button class="input-btn" id="inputD" onclick="toggleInput('D')">0</button>
                            </div>
                            <div class="input-group">
                                <label>CLK (时钟): </label>
                                <button class="input-btn clock-btn" id="inputCLK" onclick="toggleClock()">0</button>
                            </div>
                            <div class="input-group">
                                <label>RST (复位): </label>
                                <button class="input-btn" id="inputRST" onclick="toggleInput('RST')">0</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ff-core">
                        <h5>D触发器</h5>
                        <div class="ff-symbol">
                            <div class="ff-box">
                                <div class="ff-label">D</div>
                                <div class="ff-clock">CLK</div>
                                <div class="ff-output">Q</div>
                            </div>
                        </div>
                        <div class="ff-state">
                            <span>内部状态: </span>
                            <span id="ffState" class="state-value">0</span>
                        </div>
                    </div>
                    
                    <div class="ff-outputs">
                        <h5>输出</h5>
                        <div class="output-display" id="ffOutput">0</div>
                        <div class="output-display" id="ffOutputNot">1</div>
                        <div class="output-labels">
                            <div>Q</div>
                            <div>Q̄</div>
                        </div>
                    </div>
                </div>
                
                <div class="timing-diagram">
                    <h5>时序图</h5>
                    <div class="timing-chart" id="timingChart">
                        <div class="timing-row">
                            <span class="signal-label">CLK</span>
                            <div class="timing-wave" id="clkWave"></div>
                        </div>
                        <div class="timing-row">
                            <span class="signal-label">D</span>
                            <div class="timing-wave" id="dWave"></div>
                        </div>
                        <div class="timing-row">
                            <span class="signal-label">Q</span>
                            <div class="timing-wave" id="qWave"></div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-controls">
                    <button class="btn" onclick="runClockSequence()">⏰ 时钟序列演示</button>
                    <button class="btn" onclick="resetFF()">🔄 复位触发器</button>
                    <button class="btn" onclick="clearTiming()">🧹 清除时序图</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>FPGA vs 传统处理器</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>特性</th>
                        <th>FPGA</th>
                        <th>CPU</th>
                        <th>GPU</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>处理方式</td>
                        <td>并行处理</td>
                        <td>串行处理</td>
                        <td>大规模并行</td>
                    </tr>
                    <tr>
                        <td>功耗</td>
                        <td>低至中等</td>
                        <td>中等</td>
                        <td>高</td>
                    </tr>
                    <tr>
                        <td>延迟</td>
                        <td>极低</td>
                        <td>中等</td>
                        <td>中等</td>
                    </tr>
                    <tr>
                        <td>灵活性</td>
                        <td>高度可配置</td>
                        <td>固定架构</td>
                        <td>固定架构</td>
                    </tr>
                    <tr>
                        <td>开发难度</td>
                        <td>较高</td>
                        <td>中等</td>
                        <td>中等</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>FPGA设计中的逻辑类型应用</h2>
            <p>在实际的FPGA设计中，组合逻辑和时序逻辑通常协同工作，形成完整的数字系统。了解何时使用哪种逻辑类型是设计高效FPGA系统的关键。</p>
            
            <div class="feature-grid">
                <div class="feature-card" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                    <span class="feature-icon">🔗</span>
                    <h3>组合逻辑应用场景</h3>
                    <div style="text-align: left; margin-top: 15px; font-size: 14px;">
                        <p><strong>🧮 数据处理单元：</strong></p>
                        <ul>
                            <li>算术逻辑单元(ALU)</li>
                            <li>编码器/解码器</li>
                            <li>多路选择器</li>
                            <li>比较器</li>
                        </ul>
                        <p><strong>⚡ 特点：快速响应，无延迟</strong></p>
                    </div>
                </div>
                
                <div class="feature-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <span class="feature-icon">⏰</span>
                    <h3>时序逻辑应用场景</h3>
                    <div style="text-align: left; margin-top: 15px; font-size: 14px;">
                        <p><strong>💾 状态存储单元：</strong></p>
                        <ul>
                            <li>寄存器文件</li>
                            <li>计数器</li>
                            <li>状态机</li>
                            <li>FIFO缓冲区</li>
                        </ul>
                        <p><strong>🔄 特点：同步控制，状态记忆</strong></p>
                    </div>
                </div>
                
                <div class="feature-card" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                    <span class="feature-icon">🔄</span>
                    <h3>混合逻辑设计</h3>
                    <div style="text-align: left; margin-top: 15px; font-size: 14px;">
                        <p><strong>🏗️ 复杂系统设计：</strong></p>
                        <ul>
                            <li>流水线处理器</li>
                            <li>数字信号处理器</li>
                            <li>通信协议处理</li>
                            <li>控制器设计</li>
                        </ul>
                        <p><strong>⚖️ 特点：性能与控制平衡</strong></p>
                    </div>
                </div>
            </div>
            
            <div style="background: #f7fafc; padding: 25px; border-radius: 15px; margin: 25px 0;">
                <h4 style="color: #2d3748; text-align: center; margin-bottom: 20px;">📊 典型FPGA系统架构示例</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; align-items: center;">
                    <!-- 输入处理 -->
                    <div style="text-align: center;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                            <strong>📥 输入接口</strong>
                        </div>
                        <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0; margin: 5px 0;">
                            <div style="color: #e53e3e; font-weight: bold;">🔗 组合逻辑</div>
                            <div style="font-size: 12px;">数据预处理</div>
                        </div>
                    </div>
                    
                    <!-- 核心处理 -->
                    <div style="text-align: center;">
                        <div style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #2d3748; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <strong>🧠 核心处理单元</strong>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #fbb6ce;">
                                <div style="color: #d53f8c; font-weight: bold;">🔗 ALU</div>
                                <div style="font-size: 12px;">组合运算</div>
                            </div>
                            <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #90cdf4;">
                                <div style="color: #3182ce; font-weight: bold;">⏰ 寄存器</div>
                                <div style="font-size: 12px;">状态存储</div>
                            </div>
                            <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #a78bfa;">
                                <div style="color: #7c3aed; font-weight: bold;">🔄 控制单元</div>
                                <div style="font-size: 12px;">时序控制</div>
                            </div>
                            <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #fbb6ce;">
                                <div style="color: #d53f8c; font-weight: bold;">🔗 多路选择</div>
                                <div style="font-size: 12px;">数据路由</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 输出处理 -->
                    <div style="text-align: center;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                            <strong>📤 输出接口</strong>
                        </div>
                        <div style="background: #fff; padding: 12px; border-radius: 8px; border: 2px solid #9ae6b4; margin: 5px 0;">
                            <div style="color: #38a169; font-weight: bold;">⏰ 时序逻辑</div>
                            <div style="font-size: 12px;">输出缓冲</div>
                        </div>
                    </div>
                </div>
                
                <!-- 时钟系统 -->
                <div style="margin-top: 20px; text-align: center;">
                    <div style="background: #3182ce; color: white; padding: 10px 20px; border-radius: 20px; display: inline-block;">
                        ⏰ 全局时钟系统 - 同步所有时序逻辑
                    </div>
                </div>
            </div>
            
            <div style="background: #e6fffa; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #38a169;">
                <h4 style="color: #2d3748; margin-bottom: 15px;">💡 设计最佳实践</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #e53e3e;">🔗 组合逻辑设计要点：</strong>
                        <ul style="margin: 10px 0; color: #2d3748;">
                            <li>避免过长的组合逻辑链</li>
                            <li>注意传播延迟的累积</li>
                            <li>合理使用流水线设计</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: #3182ce;">⏰ 时序逻辑设计要点：</strong>
                        <ul style="margin: 10px 0; color: #2d3748;">
                            <li>统一时钟域设计</li>
                            <li>满足建立时间和保持时间</li>
                            <li>合理设计复位策略</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>应用领域</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-icon">📡</span>
                    <h3>通信系统</h3>
                    <p>5G基站、网络设备、信号处理</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🤖</span>
                    <h3>人工智能</h3>
                    <p>深度学习加速、神经网络推理</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🚗</span>
                    <h3>汽车电子</h3>
                    <p>自动驾驶、ADAS系统</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🏥</span>
                    <h3>医疗设备</h3>
                    <p>医学成像、实时信号处理</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🛡️</span>
                    <h3>航空航天</h3>
                    <p>雷达系统、卫星通信</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">💰</span>
                    <h3>金融科技</h3>
                    <p>高频交易、风险计算</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>性能优势</h2>
            <p>FPGA在特定应用场景下的性能表现：</p>
            
            <div style="margin: 20px 0;">
                <h4>处理速度提升</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85%"></div>
                </div>
                <p>相比CPU可提升10-100倍</p>
            </div>
            
            <div style="margin: 20px 0;">
                <h4>功耗效率</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%"></div>
                </div>
                <p>功耗效率比GPU高2-10倍</p>
            </div>
            
            <div style="margin: 20px 0;">
                <h4>延迟优化</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 90%"></div>
                </div>
                <p>实现微秒级响应时间</p>
            </div>
        </div>
    </div>

    <script>
        // Generate FPGA CLB grid
        function generateFPGAGrid() {
            const demo = document.getElementById('fpgaDemo');
            const gridSize = 8;
            
            for (let i = 0; i < gridSize * gridSize; i++) {
                const clb = document.createElement('div');
                clb.className = 'clb';
                clb.innerHTML = `<div class="clb-label">CLB<br>${i + 1}</div>`;
                clb.onclick = () => toggleCLB(clb);
                demo.appendChild(clb);
            }
        }

        // Toggle CLB active state
        function toggleCLB(clb) {
            clb.classList.toggle('active');
        }

        // Demonstrate different patterns
        function demonstratePattern(pattern) {
            const clbs = document.querySelectorAll('.clb');
            
            // Clear all first
            clbs.forEach(clb => clb.classList.remove('active'));
            
            if (pattern === 'clear') return;
            
            clbs.forEach((clb, index) => {
                setTimeout(() => {
                    switch (pattern) {
                        case 'sequential':
                            clb.classList.add('active');
                            break;
                        case 'random':
                            if (Math.random() > 0.5) {
                                clb.classList.add('active');
                            }
                            break;
                        case 'grid':
                            if ((Math.floor(index / 8) + index) % 2 === 0) {
                                clb.classList.add('active');
                            }
                            break;
                    }
                }, pattern === 'sequential' ? index * 100 : Math.random() * 1000);
            });
        }

        // LUT demonstration variables
        let lutInputs = { A: 0, B: 0, C: 0, D: 0, RST: 0 };
        let lutFunction = 'and';
        let lutMemory = [0, 0, 0, 0, 0, 0, 0, 1]; // 3-input LUT for simplicity
        
        // FF demonstration variables
        let ffState = 0;
        let timingData = [];
        let timingStep = 0;

        // Generate FPGA CLB grid
        function generateFPGAGrid() {
            const demo = document.getElementById('fpgaDemo');
            const gridSize = 8;
            
            for (let i = 0; i < gridSize * gridSize; i++) {
                const clb = document.createElement('div');
                clb.className = 'clb';
                clb.innerHTML = `<div class="clb-label">CLB<br>${i + 1}</div>`;
                clb.onclick = () => toggleCLB(clb);
                demo.appendChild(clb);
            }
        }

        // Toggle CLB active state
        function toggleCLB(clb) {
            clb.classList.toggle('active');
        }

        // Demonstrate different patterns
        function demonstratePattern(pattern) {
            const clbs = document.querySelectorAll('.clb');
            
            // Clear all first
            clbs.forEach(clb => clb.classList.remove('active'));
            
            if (pattern === 'clear') return;
            
            clbs.forEach((clb, index) => {
                setTimeout(() => {
                    switch (pattern) {
                        case 'sequential':
                            clb.classList.add('active');
                            break;
                        case 'random':
                            if (Math.random() > 0.5) {
                                clb.classList.add('active');
                            }
                            break;
                        case 'grid':
                            if ((Math.floor(index / 8) + index) % 2 === 0) {
                                clb.classList.add('active');
                            }
                            break;
                    }
                }, pattern === 'sequential' ? index * 100 : Math.random() * 1000);
            });
        }

        // Demonstrate logic types
        function demonstrateLogicTypes(type) {
            const clbs = document.querySelectorAll('.clb');
            
            // Clear all first
            clbs.forEach(clb => clb.classList.remove('active'));
            
            switch (type) {
                case 'combinational':
                    // Show rapid changes for combinational logic
                    let combStep = 0;
                    const combInterval = setInterval(() => {
                        clbs.forEach((clb, index) => {
                            clb.classList.remove('active');
                            if (Math.sin(combStep * 0.5 + index * 0.5) > 0) {
                                clb.classList.add('active');
                            }
                        });
                        combStep++;
                        if (combStep > 20) clearInterval(combInterval);
                    }, 200);
                    break;
                    
                case 'sequential':
                    // Show synchronized changes for sequential logic
                    let seqStep = 0;
                    const seqInterval = setInterval(() => {
                        clbs.forEach((clb, index) => {
                            clb.classList.remove('active');
                            if (seqStep % 4 === Math.floor(index / 16)) {
                                clb.classList.add('active');
                            }
                        });
                        seqStep++;
                        if (seqStep > 16) clearInterval(seqInterval);
                    }, 800);
                    break;
                    
                case 'both':
                    // Show contrast between both types
                    clbs.forEach((clb, index) => {
                        if (index < 32) {
                            // Left half - combinational (fast changes)
                            setTimeout(() => {
                                const fastInterval = setInterval(() => {
                                    clb.classList.toggle('active');
                                }, 100);
                                setTimeout(() => clearInterval(fastInterval), 2000);
                            }, index * 50);
                        } else {
                            // Right half - sequential (synchronized)
                            setTimeout(() => {
                                clb.classList.add('active');
                            }, 1000);
                        }
                    });
                    break;
            }
        }

        function initLUTMemory() {
            const memory = document.getElementById('lutMemory');
            memory.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const cell = document.createElement('div');
                cell.className = 'memory-cell';
                cell.id = `mem-${i}`;
                cell.innerHTML = `<div>地址 ${i.toString(2).padStart(3, '0')}</div><div>值: ${lutMemory[i]}</div>`;
                memory.appendChild(cell);
            }
        }

        // Toggle input for LUT/FF
        function toggleInput(input) {
            if (input === 'D' || input === 'RST') {
                // FF inputs
                lutInputs[input] = 1 - lutInputs[input];
                const btn = document.getElementById(`input${input}`);
                btn.textContent = lutInputs[input];
                btn.classList.toggle('active', lutInputs[input] === 1);
                updateFFDisplay();
            } else {
                // LUT inputs
                lutInputs[input] = 1 - lutInputs[input];
                const btn = document.getElementById(`input${input}`);
                btn.textContent = lutInputs[input];
                btn.classList.toggle('active', lutInputs[input] === 1);
                updateLUTDisplay();
            }
        }

        // Toggle clock for FF
        function toggleClock() {
            const clockBtn = document.getElementById('inputCLK');
            const isRising = !clockBtn.classList.contains('active');
            
            // Visual update
            clockBtn.classList.toggle('active');
            clockBtn.textContent = isRising ? '1' : '0';
            
            // On rising edge, update FF state
            if (isRising && lutInputs.RST === 0) {
                ffState = lutInputs.D;
                updateFFDisplay();
            }
            
            // Reset if RST is active
            if (lutInputs.RST === 1) {
                ffState = 0;
                updateFFDisplay();
            }
            
            // Update timing diagram
            addTimingPoint();
        }

        // Update LUT display
        function updateLUTDisplay() {
            const address = lutInputs.A * 4 + lutInputs.B * 2 + lutInputs.C;
            const output = lutMemory[address];
            
            // Update address display
            document.getElementById('lutAddress').textContent = 
                `${lutInputs.A}${lutInputs.B}${lutInputs.C}`;
            
            // Update memory cells
            document.querySelectorAll('.memory-cell').forEach((cell, index) => {
                cell.classList.toggle('active', index === address);
            });
            
            // Update output
            const outputDisplay = document.getElementById('lutOutput');
            outputDisplay.textContent = output;
            outputDisplay.classList.toggle('high', output === 1);
        }

        // Update FF display
        function updateFFDisplay() {
            const output = ffState;
            const outputNot = 1 - ffState;
            
            // Update state display
            document.getElementById('ffState').textContent = ffState;
            
            // Update outputs
            const outputQ = document.getElementById('ffOutput');
            const outputQNot = document.getElementById('ffOutputNot');
            
            outputQ.textContent = output;
            outputQ.classList.toggle('high', output === 1);
            
            outputQNot.textContent = outputNot;
            outputQNot.classList.toggle('high', outputNot === 1);
        }

        // Set LUT function
        function setLUTFunction(func) {
            lutFunction = func;
            
            // Update memory based on function
            switch (func) {
                case 'and':
                    lutMemory = [0, 0, 0, 0, 0, 0, 0, 1];
                    document.getElementById('logicFunction').textContent = 'AND门 (A·B·C)';
                    break;
                case 'or':
                    lutMemory = [0, 1, 1, 1, 1, 1, 1, 1];
                    document.getElementById('logicFunction').textContent = 'OR门 (A+B+C)';
                    break;
                case 'xor':
                    lutMemory = [0, 1, 1, 0, 1, 0, 0, 1];
                    document.getElementById('logicFunction').textContent = 'XOR门 (A⊕B⊕C)';
                    break;
                case 'majority':
                    lutMemory = [0, 0, 0, 1, 0, 1, 1, 1];
                    document.getElementById('logicFunction').textContent = '多数决定门';
                    break;
            }
            
            initLUTMemory();
            updateLUTDisplay();
        }

        // Add timing point to diagram
        function addTimingPoint() {
            const clkValue = document.getElementById('inputCLK').classList.contains('active') ? 1 : 0;
            const dValue = lutInputs.D;
            const qValue = ffState;
            
            timingData.push({ clk: clkValue, d: dValue, q: qValue });
            
            // Keep only last 10 points
            if (timingData.length > 10) {
                timingData.shift();
            }
            
            updateTimingDiagram();
        }

        // Duplicate functions removed for performance optimization

        // Update timing diagram
        function updateTimingDiagram() {
            const waves = ['clk', 'd', 'q'];
            const signals = ['clk', 'd', 'q'];
            
            waves.forEach((wave, index) => {
                const waveElement = document.getElementById(`${wave}Wave`);
                waveElement.innerHTML = '';
                
                timingData.forEach((point, pointIndex) => {
                    const segment = document.createElement('div');
                    segment.className = `wave-segment ${point[signals[index]] ? 'high' : 'low'}`;
                    segment.style.left = `${pointIndex * 10}%`;
                    segment.style.width = '10%';
                    waveElement.appendChild(segment);
                });
            });
        }

        // Run clock sequence demonstration
        function runClockSequence() {
            let step = 0;
            const sequence = [
                { d: 0, clk: 0 },
                { d: 1, clk: 0 },
                { d: 1, clk: 1 }, // Rising edge - should capture D=1
                { d: 1, clk: 0 },
                { d: 0, clk: 0 },
                { d: 0, clk: 1 }, // Rising edge - should capture D=0
                { d: 0, clk: 0 },
            ];
            
            function nextStep() {
                if (step < sequence.length) {
                    const { d, clk } = sequence[step];
                    
                    // Set D input
                    lutInputs.D = d;
                    const dBtn = document.getElementById('inputD');
                    dBtn.textContent = d;
                    dBtn.classList.toggle('active', d === 1);
                    
                    // Set clock
                    const clkBtn = document.getElementById('inputCLK');
                    clkBtn.textContent = clk;
                    clkBtn.classList.toggle('active', clk === 1);
                    
                    // Update FF on rising edge
                    if (clk === 1 && (step === 0 || sequence[step - 1].clk === 0)) {
                        ffState = d;
                    }
                    
                    updateFFDisplay();
                    addTimingPoint();
                    
                    step++;
                    setTimeout(nextStep, 1000);
                }
            }
            
            nextStep();
        }

        // Reset FF
        function resetFF() {
            lutInputs.RST = 1;
            const rstBtn = document.getElementById('inputRST');
            rstBtn.textContent = '1';
            rstBtn.classList.add('active');
            
            ffState = 0;
            updateFFDisplay();
            
            setTimeout(() => {
                lutInputs.RST = 0;
                rstBtn.textContent = '0';
                rstBtn.classList.remove('active');
            }, 1000);
        }

        // Clear timing diagram
        function clearTiming() {
            timingData = [];
            updateTimingDiagram();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            generateFPGAGrid();
            initLUTMemory();
            updateLUTDisplay();
            updateFFDisplay();
            
            // Add some initial animation
            setTimeout(() => demonstratePattern('grid'), 1000);
        });
    </script>
</body>
</html>