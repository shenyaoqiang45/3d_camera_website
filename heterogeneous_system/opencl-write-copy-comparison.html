<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenCL æ•°æ®ä¼ è¾“ï¼šWrite/Copy/Map è¯¦è§£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            line-height: 1.7;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        h2 {
            color: #667eea;
            font-size: 1.6em;
            margin: 35px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin: 25px 0 15px;
            display: flex;
            align-items: center;
        }
        
        h3::before {
            content: "â–¸";
            margin-right: 10px;
            color: #667eea;
        }
        
        .function-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .function-card h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .function-card h3::before {
            content: "ğŸ“Œ";
            margin-right: 10px;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.5;
            font-size: 0.9em;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 0.95em;
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .comparison-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table tr:hover {
            background: #f5f5f5;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px 20px;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .tip {
            background: #d1ecf1;
            padding: 15px 20px;
            border-left: 4px solid #17a2b8;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success {
            background: #d4edda;
            padding: 15px 20px;
            border-left: 4px solid #28a745;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .danger {
            background: #f8d7da;
            padding: 15px 20px;
            border-left: 4px solid #dc3545;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info {
            background: #e7f3ff;
            padding: 15px 20px;
            border-left: 4px solid #2196F3;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }
        
        .diagram {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .arrow {
            font-size: 2em;
            color: #667eea;
            margin: 10px 0;
        }
        
        .box {
            display: inline-block;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .host-box {
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
        }
        
        .device-box {
            background: #74b9ff;
            border: 2px solid #0984e3;
        }
        
        .map-box {
            background: #a29bfe;
            border: 2px solid #6c5ce7;
        }
        
        .performance-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .badge-fast {
            background: #28a745;
            color: white;
        }
        
        .badge-medium {
            background: #ffc107;
            color: #333;
        }
        
        .badge-slow {
            background: #dc3545;
            color: white;
        }
        
        ul {
            margin-left: 25px;
            margin-top: 10px;
        }
        
        li {
            margin: 8px 0;
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        
        .three-way-diagram {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .method-box {
            flex: 1;
            min-width: 280px;
            margin: 10px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .method-write {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        }
        
        .method-copy {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }
        
        .method-map {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
        }
        
        .method-box h4 {
            margin-top: 0;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>OpenCL æ•°æ®ä¼ è¾“ä¸‰å‰‘å®¢</h1>
            <p>Write / Copy / Map å®Œå…¨å¯¹æ¯”æŒ‡å—</p>
        </header>
        
        <div class="content">
            <section>
                <h2>ğŸ“‹ å‡½æ•°ç­¾å</h2>
                
                <div class="function-card">
                    <h3>clEnqueueWriteBuffer - ä¸»æœºåˆ°è®¾å¤‡å†™å…¥</h3>
<pre>cl_int clEnqueueWriteBuffer(
    cl_command_queue command_queue,
    cl_mem buffer,              // ç›®æ ‡è®¾å¤‡ç¼“å†²åŒº
    cl_bool blocking_write,     // æ˜¯å¦é˜»å¡ç­‰å¾…
    size_t offset,              // å†™å…¥åç§»é‡
    size_t size,                // å†™å…¥å­—èŠ‚æ•°
    const void *ptr,            // æºä¸»æœºå†…å­˜æŒ‡é’ˆ
    cl_uint num_events_in_wait_list,
    const cl_event *event_wait_list,
    cl_event *event
)</pre>
                </div>

                <div class="function-card">
                    <h3>clEnqueueCopyBuffer - è®¾å¤‡åˆ°è®¾å¤‡æ‹·è´</h3>
<pre>cl_int clEnqueueCopyBuffer(
    cl_command_queue command_queue,
    cl_mem src_buffer,          // æºè®¾å¤‡ç¼“å†²åŒº
    cl_mem dst_buffer,          // ç›®æ ‡è®¾å¤‡ç¼“å†²åŒº
    size_t src_offset,          // æºåç§»é‡
    size_t dst_offset,          // ç›®æ ‡åç§»é‡
    size_t size,                // æ‹·è´å­—èŠ‚æ•°
    cl_uint num_events_in_wait_list,
    const cl_event *event_wait_list,
    cl_event *event
)</pre>
                </div>

                <div class="function-card">
                    <h3>clEnqueueMapBuffer - æ˜ å°„è®¾å¤‡å†…å­˜åˆ°ä¸»æœºåœ°å€ç©ºé—´</h3>
<pre>void* clEnqueueMapBuffer(
    cl_command_queue command_queue,
    cl_mem buffer,              // è¦æ˜ å°„çš„è®¾å¤‡ç¼“å†²åŒº
    cl_bool blocking_map,       // æ˜¯å¦é˜»å¡ç­‰å¾…
    cl_map_flags map_flags,     // æ˜ å°„æ ‡å¿— (READ/WRITE/WRITE_INVALIDATE)
    size_t offset,              // æ˜ å°„åç§»é‡
    size_t size,                // æ˜ å°„å­—èŠ‚æ•°
    cl_uint num_events_in_wait_list,
    const cl_event *event_wait_list,
    cl_event *event,
    cl_int *errcode_ret         // è¿”å›é”™è¯¯ç 
)
// è¿”å›ï¼šæŒ‡å‘æ˜ å°„å†…å­˜çš„ä¸»æœºæŒ‡é’ˆ

// é…å¯¹ä½¿ç”¨ï¼š
cl_int clEnqueueUnmapMemObject(
    cl_command_queue command_queue,
    cl_mem memobj,
    void *mapped_ptr,           // MapBuffer è¿”å›çš„æŒ‡é’ˆ
    cl_uint num_events_in_wait_list,
    const cl_event *event_wait_list,
    cl_event *event
)</pre>
                </div>
            </section>

            <section>
                <h2>ğŸ”„ ä¸‰è€…æ ¸å¿ƒå¯¹æ¯”</h2>
                
                <div class="diagram">
                    <h3 style="color: #667eea; margin-bottom: 25px;">æ•°æ®æµå‘ç¤ºæ„å›¾</h3>
                    
                    <div style="margin: 30px 0;">
                        <div style="font-weight: bold; margin-bottom: 15px; color: #d63031;">â‘  WriteBuffer - æ˜¾å¼æ‹·è´</div>
                        <div class="box host-box">ä¸»æœºå†…å­˜</div>
                        <div class="arrow">â†’ æ‹·è´ â†’</div>
                        <div class="box device-box">è®¾å¤‡ç¼“å†²åŒº</div>
                        <div style="margin-top: 10px; color: #666; font-size: 0.9em;">
                            PCIe æ€»çº¿ä¼ è¾“ (~16 GB/s)
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0; padding-top: 20px; border-top: 2px dashed #ddd;">
                        <div style="font-weight: bold; margin-bottom: 15px; color: #0984e3;">â‘¡ CopyBuffer - è®¾å¤‡å†…æ‹·è´</div>
                        <div class="box device-box">è®¾å¤‡ç¼“å†²åŒº A</div>
                        <div class="arrow">â†’ å¿«é€Ÿæ‹·è´ â†’</div>
                        <div class="box device-box">è®¾å¤‡ç¼“å†²åŒº B</div>
                        <div style="margin-top: 10px; color: #666; font-size: 0.9em;">
                            è®¾å¤‡å†…å­˜æ€»çº¿ (~500-900 GB/s)
                        </div>
                    </div>

                    <div style="margin: 30px 0; padding-top: 20px; border-top: 2px dashed #ddd;">
                        <div style="font-weight: bold; margin-bottom: 15px; color: #6c5ce7;">â‘¢ MapBuffer - åœ°å€æ˜ å°„</div>
                        <div class="box device-box">è®¾å¤‡ç¼“å†²åŒº</div>
                        <div class="arrow">â‡„ æ˜ å°„ â‡„</div>
                        <div class="box map-box">ä¸»æœºåœ°å€ç©ºé—´</div>
                        <div style="margin-top: 10px; color: #666; font-size: 0.9em;">
                            é›¶æ‹·è´è®¿é—®ï¼ˆç†æƒ³æƒ…å†µï¼‰æˆ–å»¶è¿Ÿä¼ è¾“
                        </div>
                    </div>
                </div>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th style="width: 18%;">ç‰¹æ€§</th>
                            <th style="width: 27%;">WriteBuffer</th>
                            <th style="width: 27%;">CopyBuffer</th>
                            <th style="width: 28%;">MapBuffer</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>æ•°æ®æº</strong></td>
                            <td>ä¸»æœºå†…å­˜</td>
                            <td>è®¾å¤‡ç¼“å†²åŒº</td>
                            <td>è®¾å¤‡ç¼“å†²åŒº</td>
                        </tr>
                        <tr>
                            <td><strong>æ•°æ®ç›®æ ‡</strong></td>
                            <td>è®¾å¤‡ç¼“å†²åŒº</td>
                            <td>è®¾å¤‡ç¼“å†²åŒº</td>
                            <td>ä¸»æœºåœ°å€ç©ºé—´</td>
                        </tr>
                        <tr>
                            <td><strong>ä¼ è¾“æ–¹å¼</strong></td>
                            <td>æ˜¾å¼æ‹·è´</td>
                            <td>æ˜¾å¼æ‹·è´</td>
                            <td>æ˜ å°„ï¼ˆå¯èƒ½é›¶æ‹·è´ï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>ä¼ è¾“è·¯å¾„</strong></td>
                            <td>CPU â†’ PCIe â†’ GPU</td>
                            <td>GPU å†…éƒ¨æ€»çº¿</td>
                            <td>è§†ç¡¬ä»¶è€Œå®š</td>
                        </tr>
                        <tr>
                            <td><strong>æ€§èƒ½</strong></td>
                            <td><span class="performance-badge badge-slow">æ…¢</span> ~16 GB/s</td>
                            <td><span class="performance-badge badge-fast">å¿«</span> ~500 GB/s</td>
                            <td><span class="performance-badge badge-medium">è§†æƒ…å†µ</span> é›¶æ‹·è´æœ€ä¼˜</td>
                        </tr>
                        <tr>
                            <td><strong>ä½¿ç”¨æ–¹å¼</strong></td>
                            <td>ä¸€æ¬¡æ€§è°ƒç”¨</td>
                            <td>ä¸€æ¬¡æ€§è°ƒç”¨</td>
                            <td>Map + è®¿é—® + Unmap</td>
                        </tr>
                        <tr>
                            <td><strong>ä¸»æœºè®¿é—®</strong></td>
                            <td>éœ€è¦ä¸»æœºå†…å­˜</td>
                            <td>ä¸æ¶‰åŠä¸»æœº</td>
                            <td>ç›´æ¥é€šè¿‡æŒ‡é’ˆ</td>
                        </tr>
                        <tr>
                            <td><strong>çµæ´»æ€§</strong></td>
                            <td>ç®€å•ç›´æ¥</td>
                            <td>ç®€å•ç›´æ¥</td>
                            <td>å¯éšæœºè®¿é—®</td>
                        </tr>
                        <tr>
                            <td><strong>å…¸å‹å»¶è¿Ÿ</strong></td>
                            <td>æ˜¾å¼åŒæ­¥</td>
                            <td>å¼‚æ­¥æœ€å¿«</td>
                            <td>Map/Unmap æœ‰å¼€é”€</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h2>ğŸ—ºï¸ MapBuffer æ·±åº¦è§£æ</h2>
                
                <div class="info">
                    <strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong> MapBuffer ä¸æ˜¯ç®€å•çš„æ•°æ®æ‹·è´ï¼Œè€Œæ˜¯å°†è®¾å¤‡å†…å­˜<strong>æ˜ å°„åˆ°ä¸»æœºåœ°å€ç©ºé—´</strong>ï¼Œè®©ä½ å¯ä»¥é€šè¿‡ä¸»æœºæŒ‡é’ˆç›´æ¥è®¿é—®è®¾å¤‡å†…å­˜ã€‚
                </div>

                <h3>æ˜ å°„æ ‡å¿— (map_flags)</h3>
                <div class="function-card" style="background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);">
<pre style="background: white; color: #333;">CL_MAP_READ              // åªè¯»æ˜ å°„
CL_MAP_WRITE             // è¯»å†™æ˜ å°„
CL_MAP_WRITE_INVALIDATE  // å†™æ˜ å°„ï¼Œä¸¢å¼ƒåŸå†…å®¹ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰</pre>
                </div>

                <h3>å·¥ä½œåŸç†</h3>
<pre>// 1. æ˜ å°„é˜¶æ®µ
float* host_ptr = (float*)clEnqueueMapBuffer(
    queue, device_buffer, CL_TRUE,
    CL_MAP_READ | CL_MAP_WRITE,  // å¯è¯»å†™
    0, size, 0, NULL, NULL, &err
);
// æ­¤æ—¶å¯èƒ½å‘ç”Ÿæ•°æ®ä¼ è¾“ï¼ˆå–å†³äºç¡¬ä»¶å’Œç¼“å†²åŒºåˆ›å»ºæ ‡å¿—ï¼‰

// 2. è®¿é—®é˜¶æ®µï¼šåƒè®¿é—®æ™®é€šå†…å­˜ä¸€æ ·
for (int i = 0; i < N; i++) {
    host_ptr[i] = host_ptr[i] * 2.0f;  // ç›´æ¥è¯»å†™
}

// 3. è§£é™¤æ˜ å°„ï¼šæ•°æ®åŒæ­¥å›è®¾å¤‡
clEnqueueUnmapMemObject(queue, device_buffer, host_ptr, 0, NULL, NULL);
// æ­¤æ—¶å¯èƒ½å‘ç”Ÿæ•°æ®ä¼ è¾“ï¼ˆå¦‚æœåœ¨ Map æ—¶æ²¡ä¼ è¾“ï¼‰
</pre>

                <h3>æ€§èƒ½ç‰¹æ€§</h3>
                <div class="highlight">
                    <strong>å…³é”®æ€§èƒ½å› ç´ ï¼š</strong>
                    <ul>
                        <li><strong>é›¶æ‹·è´åœºæ™¯</strong>ï¼šä½¿ç”¨ <code>CL_MEM_ALLOC_HOST_PTR</code> æˆ– <code>CL_MEM_USE_HOST_PTR</code> åˆ›å»ºçš„ç¼“å†²åŒºï¼ŒMap å¯èƒ½å®ç°é›¶æ‹·è´</li>
                        <li><strong>å»¶è¿Ÿä¼ è¾“</strong>ï¼šæ•°æ®ä¼ è¾“å¯èƒ½åœ¨ Map æ—¶ã€Unmap æ—¶ï¼Œæˆ–è®¿é—®æ—¶å‘ç”Ÿ</li>
                        <li><strong>Map å¼€é”€</strong>ï¼šMap/Unmap æœ¬èº«æœ‰å›ºå®šå¼€é”€ï¼ˆ~å‡ å¾®ç§’ï¼‰</li>
                        <li><strong>é€‚åˆé¢‘ç¹è®¿é—®</strong>ï¼šå¦‚æœéœ€è¦å¤šæ¬¡è¯»å†™ï¼ŒMap ä¸€æ¬¡æ¯”å¤šæ¬¡ Read/Write é«˜æ•ˆ</li>
                    </ul>
                </div>

                <h3>CL_MAP_WRITE_INVALIDATE ä¼˜åŒ–</h3>
<pre>// âŒ æ™®é€šå†™æ˜ å°„ï¼šéœ€è¦å…ˆè¯»å–åŸå†…å®¹
float* ptr = clEnqueueMapBuffer(queue, buffer, CL_TRUE,
                                 CL_MAP_WRITE, ...);

// âœ… INVALIDATEï¼šå‘Šè¯‰é©±åŠ¨ä¸éœ€è¦åŸå†…å®¹ï¼Œè·³è¿‡è¯»å–
float* ptr = clEnqueueMapBuffer(queue, buffer, CL_TRUE,
                                 CL_MAP_WRITE_INVALIDATE, ...);
// é€‚ç”¨äºï¼šå®Œå…¨è¦†ç›–å†™å…¥ï¼Œä¸å…³å¿ƒåŸæ•°æ®</pre>

                <div class="tip">
                    <strong>ğŸ’¡ ä½•æ—¶ä½¿ç”¨ WRITE_INVALIDATEï¼š</strong>
                    <ul>
                        <li>å®Œå…¨é‡å†™ç¼“å†²åŒºå†…å®¹ï¼Œä¸éœ€è¦è¯»å–åŸæ•°æ®</li>
                        <li>åˆå§‹åŒ–æ–°æ•°æ®</li>
                        <li>å¯æ˜¾è‘—æå‡æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>ğŸ’¡ ä½¿ç”¨åœºæ™¯å¯¹æ¯”</h2>
                
                <div class="three-way-diagram">
                    <div class="method-box method-write">
                        <h4>ğŸ“¤ WriteBuffer</h4>
                        <strong>é€‚ç”¨åœºæ™¯ï¼š</strong>
                        <ul>
                            <li>åˆå§‹åŒ–è¾“å…¥æ•°æ®</li>
                            <li>ä¸€æ¬¡æ€§æ•°æ®ä¼ è¾“</li>
                            <li>æ•°æ®åœ¨ä¸»æœºå†…å­˜ä¸­å‡†å¤‡å¥½</li>
                            <li>ç®€å•ç›´æ¥çš„åœºæ™¯</li>
                        </ul>
                        <br>
                        <strong>ä¼˜ç‚¹ï¼š</strong>
                        <ul>
                            <li>ä½¿ç”¨ç®€å•</li>
                            <li>è¯­ä¹‰æ¸…æ™°</li>
                        </ul>
                        <br>
                        <strong>ç¼ºç‚¹ï¼š</strong>
                        <ul>
                            <li>PCIe å¸¦å®½é™åˆ¶</li>
                            <li>éœ€è¦ä¸»æœºå†…å­˜</li>
                        </ul>
                    </div>

                    <div class="method-box method-copy">
                        <h4>ğŸ”„ CopyBuffer</h4>
                        <strong>é€‚ç”¨åœºæ™¯ï¼š</strong>
                        <ul>
                            <li>Kernel pipeline ä¼ é€’</li>
                            <li>è®¾å¤‡å†…æ•°æ®å¤‡ä»½</li>
                            <li>åŒç¼“å†²äº¤æ¢</li>
                            <li>æ•°æ®é‡ç»„</li>
                        </ul>
                        <br>
                        <strong>ä¼˜ç‚¹ï¼š</strong>
                        <ul>
                            <li>æå¿«ï¼ˆè®¾å¤‡å†…éƒ¨ï¼‰</li>
                            <li>ä¸å ç”¨ PCIe</li>
                        </ul>
                        <br>
                        <strong>ç¼ºç‚¹ï¼š</strong>
                        <ul>
                            <li>ä»…é™è®¾å¤‡é—´</li>
                            <li>éœ€è¦é¢å¤–å†…å­˜</li>
                        </ul>
                    </div>

                    <div class="method-box method-map">
                        <h4>ğŸ—ºï¸ MapBuffer</h4>
                        <strong>é€‚ç”¨åœºæ™¯ï¼š</strong>
                        <ul>
                            <li>éœ€è¦éšæœºè®¿é—®</li>
                            <li>éƒ¨åˆ†æ›´æ–°æ•°æ®</li>
                            <li>é¢‘ç¹è¯»å†™æ“ä½œ</li>
                            <li>é›¶æ‹·è´ä¼˜åŒ–</li>
                        </ul>
                        <br>
                        <strong>ä¼˜ç‚¹ï¼š</strong>
                        <ul>
                            <li>å¯èƒ½é›¶æ‹·è´</li>
                            <li>çµæ´»è®¿é—®</li>
                        </ul>
                        <br>
                        <strong>ç¼ºç‚¹ï¼š</strong>
                        <ul>
                            <li>Map/Unmap å¼€é”€</li>
                            <li>å®ç°å¤æ‚</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h2>âš¡ æ€§èƒ½å¯¹æ¯”å®æµ‹</h2>
                
                <h3>åœºæ™¯ 1ï¼šä¼ è¾“ 1 GB æ•°æ®åˆ°è®¾å¤‡</h3>
<pre>// WriteBuffer
float data[256*1024*1024];
clEnqueueWriteBuffer(queue, buffer, CL_TRUE, 0, size, data, ...);
// è€—æ—¶ï¼š~60ms (PCIe 3.0 x16)

// MapBuffer (CL_MEM_ALLOC_HOST_PTR)
float* ptr = clEnqueueMapBuffer(queue, buffer, CL_TRUE, 
                                 CL_MAP_WRITE_INVALIDATE, ...);
memcpy(ptr, data, size);
clEnqueueUnmapMemObject(queue, buffer, ptr, ...);
// è€—æ—¶ï¼š~40ms (ä¼˜åŒ–çš„å†…å­˜è®¿é—®)

// MapBuffer (é›¶æ‹·è´ï¼Œç†æƒ³æƒ…å†µ)
float* ptr = clEnqueueMapBuffer(queue, buffer, CL_TRUE, 
                                 CL_MAP_WRITE, ...);
// ç›´æ¥æ“ä½œ ptrï¼Œæ— éœ€ memcpy
clEnqueueUnmapMemObject(queue, buffer, ptr, ...);
// è€—æ—¶ï¼š~å‡ å¾®ç§’ (Map/Unmap å¼€é”€)</pre>

                <h3>åœºæ™¯ 2ï¼šæ›´æ–°ç¼“å†²åŒºçš„å°éƒ¨åˆ†æ•°æ®</h3>
<pre>// WriteBufferï¼šå³ä½¿åªæ›´æ–° 1%ï¼Œä¹Ÿè¦ä¼ è¾“å…¨éƒ¨
clEnqueueWriteBuffer(queue, buffer, CL_TRUE, 0, full_size, data, ...);
// è€—æ—¶ï¼š~60ms

// MapBufferï¼šåªä¼ è¾“éœ€è¦çš„éƒ¨åˆ†
float* ptr = clEnqueueMapBuffer(queue, buffer, CL_TRUE, 
                                 CL_MAP_WRITE, 
                                 offset, partial_size, ...);
// ä¿®æ”¹ ptr[0...partial_size]
clEnqueueUnmapMemObject(queue, buffer, ptr, ...);
// è€—æ—¶ï¼š~1ms (ä»…ä¼ è¾“ 1%)</pre>

                <h3>åœºæ™¯ 3ï¼šKernel Pipeline</h3>
<pre>// âŒ é€šè¿‡ä¸»æœºä¸­è½¬ï¼ˆä½æ•ˆï¼‰
clEnqueueReadBuffer(queue, buffer1, CL_TRUE, 0, size, host_mem, ...);   // 60ms
clEnqueueWriteBuffer(queue, buffer2, CL_TRUE, 0, size, host_mem, ...);  // 60ms
// æ€»è®¡ï¼š120ms

// âœ… è®¾å¤‡å†…æ‹·è´ï¼ˆé«˜æ•ˆï¼‰
clEnqueueCopyBuffer(queue, buffer1, buffer2, 0, 0, size, ...);          // 2ms
// æ€»è®¡ï¼š2ms (å¿« 60 å€ï¼)</pre>

                <div class="success">
                    <strong>âœ… æ€§èƒ½æœ€ä½³å®è·µï¼š</strong>
                    <ul>
                        <li><strong>å¤§é‡ä¸€æ¬¡æ€§ä¼ è¾“</strong>ï¼šWriteBuffer</li>
                        <li><strong>è®¾å¤‡é—´ä¼ é€’</strong>ï¼šCopyBufferï¼ˆæœ€å¿«ï¼‰</li>
                        <li><strong>éƒ¨åˆ†æ›´æ–°/éšæœºè®¿é—®</strong>ï¼šMapBuffer</li>
                        <li><strong>é¢‘ç¹è¯»å†™åŒä¸€ç¼“å†²åŒº</strong>ï¼šMapBufferï¼ˆMap ä¸€æ¬¡ï¼Œå¤šæ¬¡æ“ä½œï¼‰</li>
                        <li><strong>é›¶æ‹·è´åœºæ™¯</strong>ï¼šMapBuffer + CL_MEM_ALLOC_HOST_PTR</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹</h2>
                
                <h3>ç¤ºä¾‹ 1ï¼šWriteBuffer - åˆå§‹åŒ–æ•°æ®</h3>
<pre>float input_data[1024];
prepare_data(input_data);

cl_mem buffer = clCreateBuffer(ctx, CL_MEM_READ_ONLY, 
                                sizeof(input_data), NULL, &err);

// ç®€å•ç›´æ¥
clEnqueueWriteBuffer(queue, buffer, CL_TRUE, 
                     0, sizeof(input_data), input_data,
                     0, NULL, NULL);</pre>

                <h3>ç¤ºä¾‹ 2ï¼šCopyBuffer - Kernel Pipeline</h3>
<pre>cl_mem buffer1 = clCreateBuffer(ctx, CL_MEM_READ_WRITE, size, NULL, &err);
cl_mem buffer2 = clCreateBuffer(ctx, CL_MEM_READ_WRITE, size, NULL, &err);

// Kernel1 è¾“å‡ºåˆ° buffer1
clSetKernelArg(kernel1, 1, sizeof(cl_mem), &buffer1);
clEnqueueNDRangeKernel(queue, kernel1, ...);

// è®¾å¤‡å†…å¿«é€Ÿä¼ é€’
clEnqueueCopyBuffer(queue, buffer1, buffer2, 0, 0, size, 0, NULL, NULL);

// Kernel2 ä» buffer2 è¯»å–
clSetKernelArg(kernel2, 0, sizeof(cl_mem), &buffer2);
clEnqueueNDRangeKernel(queue, kernel2, ...);</pre>

                <h3>ç¤ºä¾‹ 3ï¼šMapBuffer - éƒ¨åˆ†æ›´æ–°</h3>
<pre>// åˆ›å»ºä¸»æœºå¯è®¿é—®çš„ç¼“å†²åŒº
cl_mem